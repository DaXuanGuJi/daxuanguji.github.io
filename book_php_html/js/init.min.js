//IE_entries
Object.entries || (Object.entries = function (b) {
	var e = Array(b.length),
	f;
	for (f in b)
		e.unshift([f, b[f]]);
	return e
});
function ByID(b) {
	return document.getElementById(b)
}
var upchang = function (b) {
	var e = document.createEvent("HTMLEvents");
	e.initEvent("change", !0, !0);
	b.dispatchEvent(e)
}, imgmu = function () {
	return"https://daxuanguji.github.io/book_php_html/";
	return "./"
}, click_error = function () {
	alert("\u7f51\u7edc\u7248\u65e0\u4e0a\u4f20\u529f\u80fd\n\u5b8c\u6574\u529f\u80fd\u8bf7\u7528\u79bb\u7ebf\u7248")
}, Utf8BomDel = function (b) {
	65279 === b.charCodeAt(0) && (b = b.slice(1));
	61371 === b.charCodeAt(0) && 48063 === b.charCodeAt(1) && (b = b.slice(3));
	return b
}, png_rex = /[\ud840-\ud888]*[\u3400-\uFAD9]\.png/, png_rar = /([\ud840-\ud888]*[\u3400-\uFAD9])(_\d+_[0-9a-fA-F]{32})*\.png/, imgpath = imgmu(), saveImgPath = imgpath + "_save/", batpath = imgpath + "bat/", bookspath = imgpath + "book/", oldpath = imgpath += "images/", imgpath = wpyt.value + "?img\x3d" + imgpath, getDPIarr = getDPI(), inpx = Math.min(getDPIarr[0], getDPIarr[1]), mmpx = getDPIarr[1] / 25.4, utindex = 0, utfilesize = 0, uflg = 0;
FULL = 1;
var prcstop = 0, editbox = null, MCKID = null, pagefiles = null, predoc = null, txtconf = null, bookname = null, readsrt = [], readsrtobj = [], selectbox = [], fxtxtbox = [], tbfilelist = [], colorlist = ["rgba(0,0,255,1)", "rgba(255,0,255,1)", "rgba(162,153,255,1)"], fontlist = {}, Wdf = document.documentElement.clientWidth || document.body.clientWidth || document.documentElement.offsetWidth || document.body.offsetWidth, Hdf = document.documentElement.clientHeight || document.body.clientHeight || document.documentElement.offsetHeight || document.body.offsetHeight;
document.body.onload = function (b) {
	b = "txtpath loadtxt reloadtxt loadurltxt loadurltxtlast picpath dpi set settop boxdiv picdiv canvs qpimg pgs het wid rda rdb rmerge lmerge ptbody rebody ptallpng ptallpdf ptbook lput rput qrcode qrwh qrcolor qrrx brcode brsize brcolor brwh brcodeimg qrcodeimg code cealimg errtxt ptname ptcopyright ptdate ptauthor rptname rptcopyright rptdate rptauthor openfile loadobj splitimg expobj saveobj ffid tbackpic tbookpic tbookht tbodyht tbodytxt tbodyimg tbodyret tbodypic tbodybk tbodycel tbodycelnum tbodyrand txtcel ttxtcel ptceal ptfengx ptwat costxt1 costxt2 costxt3 cosimg1 cosimg2 cosimg3 costxt4 book3d covertxt cktxtp mdbkname loadback autoback listpage txtgui jsoneditor setex stup stdw stuf stuh stuw stum stub stuc stus stuk stut stupk stuupk stud wpyt pytexe txtfc txtbc txtpfc txtpbc savepdf savetb savett autotb autopage cmdexe autopng savepng kanpng usize thisfpage thisrpage retp imgp txtp rptbk rptbkT rptag rptwat kaisu nextpg povpg startIndex fda fdb tda tdb mergeval nullval mrrorbk bookIndex bookIndexbtn".split(" ");
	var e = "";
	for (c in b)
		e += "var " + b[c] + ' \x3d document.getElementById("' + b[c] + '");';
	eval(e);
	var f = {},
	k = canvs.getContext("2d"),
	g = function (a, d) {
		openfile.value = "";
		openfile.accept = "loadobj" == d.id || "loadpage" == d.id ? ".json" : "loadtxt" == d.id || "loadurltxt" == d.id ? ".txt,.htm,.html" : "image/*";
		MCKID = d;
		a.focus();
		var b = document.createEvent("MouseEvents");
		b.initEvent("click", !0, !0);
		a.dispatchEvent(b)
	},
	h = function () {
		sendExeStatu();
		return !0;
	},
	p = function (a) {
		/^\d+$/.test(a.value) && (a = D(pgs, "custom"), pgs.options[a].value = wid.value + "," + het.value, pgs.selectedIndex = a, upchang(pgs))
	},
	u = function () {
		bookpath = imgpath + ptobj.bookpath;
		bodypath = imgpath + ptobj.bodypath;
		infopath = imgpath + ptobj.infopath;
		backpath = imgpath + ptobj.backpath;
		infoimage = ptobj.infoimage;
		nowhimage = ptobj.nowhimage
	},
	A = function (a) {
		errtxt.innerHTML = "";
		"openfile" == a.id && (a = MCKID);
		try {
			switch (a.id) {
			case "ptceal":
				if (/base64,/.test(a.value))
					cealimg.src = a.value;
				else {
					var d = imgpath + ptset.backpath + a.value,
					b = new Image,
					e = document.createElement("canvas"),
					f = e.getContext("2d");
					b.src = upurl(d);
					b.setAttribute("crossOrigin", "anonymous");
					b.onload = function (a) {
						e.width = this.naturalWidth;
						e.height = this.naturalHeight;
						f.drawImage(b, 0, 0, e.width, e.height);
						ptset.bookobj.box.cealbox[2][1] = cealimg.src = toCvDataURL(e)
					};
					b.onerror = function (d) {
						errtxt.innerHTML = "back\u76ee\u5f55\u4e0b\u672a\u627e\u5230" + a.value + " /\u91cd\u542fWEB\u518d\u8bd5"
					}
					sendExeStatu();
				}
				break;
			case "ptfengx":
				if (/^\d+,#[0-f]+,#[0-f]+$/.test(a.value)) {
					var g = a.value.split(",");
					ptset.bookobj.fengx = Number(g[0]);
					ptset.bookobj.box.imagebox4[1] = g[1];
					ptset.bookobj.box.imagebox5[1] = g[1];
					ptset.bookobj.box.imagebox6[1] = g[1];
					ptset.bookobj.box.imagebox7[1] = g[1];
					ptset.bookobj.box.imagebox8[1] = g[1];
					ptset.bookobj.box.imagebox9[1] = g[1];
					ptset.bookobj.box.imagebox3[1] = g[2];
					ptset.bookobj.box.imagebox2[1] = g[2]
				}
				break;
			case "ptwat":
				if (/\.png$/.test(a.value)) {
					var k = prompt("\u8bf7\u8f93\u5165\u8be5\u56fe\u7247[" + a.value + "]\u4e3a\u9875\u9762\u4e0a\u6c34\u5370\u56fe\u7247\u8fd8\u662f\u4e0b\u6c34\u5370\u56fe\u7247!\n0\u4e3a\u4e0a\u6c34\u5370\n1\u4e3a\u4e0b\u6c34\u5370", 1);
					k ? ("0" == k && (ptset.bodyobj.wat.box.imgbox3[2][1] = a.value), "1" == k && (ptset.bodyobj.wat.box.imgbox4[2][1] = a.value), a.value = ptset.bodyobj.wat.atxt.and[2]) : alert("\u672a\u8f93\u5165")
				} else
					ptset.bodyobj.wat.atxt.and[2] = a.value;
				break;
			case "tbookht":
				ptset.bookobj.height[0] = parseInt(a.value);
				break;
			case "tbodyht":
				ptset.bodyobj.height[0] = parseInt(a.value);
				break;
			case "tbodytxt":
				ptset.bodyobj.subpath[0] = a.value;
				break;
			case "tbodyret":
				ptset.bodyobj.subpath[1] = a.value;
				break;
			case "tbodyimg":
				ptset.bodyobj.subpath[2] = a.value;
				break;
			case "tbookpic":
				ptset.bookobj.bkpic[1][1] = a.value;
				break;
			case "tbodypic":
				ptset.bodyobj.bkpic[1][1] = a.value;
				break;
			case "tbodybk":
				ptset.bodyobj.bk.tbt[0][1] = a.value;
				ptset.bodyobj.bk.tbt[1][1] = a.value;
				ptset.bodyobj.bk.tbt[2][1] = a.value;
				ptset.bodyobj.bk.tbt[3][1] = a.value;
				break;
			case "tbodycel":
				ptset.bodyobj.col.clt[1][1] = a.value;
				break;
			case "tbodycelnum":
				ptset.bodyobj.col.cls = /^\d+$/.test(a.value) ? parseInt(a.value) : 8;
				var l = ptset.bodyobj.col.cls;
				ptset.setline["n" + l] && eval(ptset.setline["n" + l].replace(/[\r\n\t]/g, ""));
				try {
					localStorage.setrandcls = ptset.bodyobj.trand + "," + ptset.bodyobj.col.cls
				} catch (F) {}

				break;
			case "tbodyrand":
				uflg = ptset.bodyobj.trand = Number(a.value);
				if(uflg==0)alert("本地字体需选择本地字体目录【读取文本前的下拉列表选择】,若目录无该字图片无法显示");
				for (var h = [bkp1, bkp2, bkp3, bkp4, bkp5, bkp6, bkp7, bkp8], d = 0; d < h.length; d++)
					h[d].value = "", upchang(h[d]);
				try {
					localStorage.setrandcls = ptset.bodyobj.trand + "," + ptset.bodyobj.col.cls
				} catch (F) {}

				break;
			case "ttxtcel":
				ptset.bodyobj.col.tlt[1][1] = a.value;
				break;
			case "txtfc":
				2 == uflg && (ptset.bodyobj.tfont[2] = ptset.bodyobj.wfont[2] = ptset.bodyobj.bfont[2] = ptset.bodyobj.pfont[2] = [a.value]);
				ptset.bodyobj.color[0] = a.value;
				break;
			case "txtbc":
				2 == uflg && (ptset.bodyobj.tagimage[2] = [a.value, a.value, a.value, a.value, a.value, a.value]);
				ptset.bodyobj.color[1] = a.value;
				break;
			case "txtpfc":
				ptset.bodyobj.pcolor[0] = a.value;
				break;
			case "txtpbc":
				ptset.bodyobj.pcolor[1] = a.value;
				break;
			case "book3d":
				ptset.bookobj.bk3d = a.value;
				break;
			case "cosimg1":
				ptset.bookobj.box.imagebox0[1] = a.value;
				break;
			case "cosimg3":
				ptset.bookobj.box.imagebox1[1] = a.value;
				break;
			case "cosimg2":
				ptset.bookobj.box.imagebox01[1] = a.value.split(",")[1];
				ptset.bookobj.box.imagebox01[0][2] = Number(a.value.split(",")[0]);
				ptset.bookobj.box.imagebox01[0][0] = "w-" + Number(a.value.split(",")[0]) / 2;
				break;
			case "costxt1":
				ptset.bookobj.text.wtxt[1] = a.value;
				break;
			case "costxt2":
				ptset.bookobj.text.wtxt2[1] = a.value;
				break;
			case "costxt3":
				ptset.bookobj.text.htxt[1] = a.value;
				break;
			case "costxt4":
				ptset.bookobj.text.htxt2[1] = a.value;
				break;
			case "version":
				h = a.value.split(",");
				ptset.bookobj.text.versionL[1] = /L/.test(h[2]) ? h[0] : "";
				ptset.bookobj.box.cealcopyboxL[2][1] = /L/.test(h[2]) ? h[1].replace(/(\.[^\.]+$)/, "_l$1") : "";
				ptset.bookobj.text.versionR[1] = /R/.test(h[2]) ? h[0] : "";
				ptset.bookobj.box.cealcopyboxR[2][1] = /R/.test(h[2]) ? h[1].replace(/(\.[^\.]+$)/, "_r$1") : "";
				ptset.bookobj.box.cealcopyboxM[2][1] = /M/.test(h[2]) ? h[1].replace(/(\.[^\.]+$)/, "_m$1") : "";
				break;
			case "backpic":
				ptset.backcolor = a.value;
				break;
			case "tbackpic":
				ptset.backimage[1] = a.value;
				break;
			case "bookpic":
				ptset.bookobj.bkpic[2] = a.value;
				break;
			case "bodypic":
				ptset.bodyobj.bkpic[2] = a.value;
				break;
			case "bodybk":
				ptset.bodyobj.bk.tbc = [a.value, a.value, a.value, a.value];
				break;
			case "bodycel":
				ptset.bodyobj.col.clt[0][0] = a.value;
				break;
			case "txtcel":
				ptset.bodyobj.col.tlt[0] = a.value;
				break;
			case "ptname":
				ptset.bookobj.loads.text.name[1] = a.value;
				/\$/.test(a.value) ? (bookname = [[20, 20, 20, 186, -20, 1], a.value, ptset.bookobj.loads.text.name[2], ptset.bookobj.loads.text.name[3], ptset.bookobj.loads.text.name[4], ptset.bookobj.loads.text.name[5], ptset.bookobj.loads.text.name[6]], ptset.bookobj.loads.text.name[1] = " ") : bookname = null;
				break;
			case "ptauthor":
				ptset.bookobj.loads.text.author[1] = a.value;
				break;
			case "ptcopyright":
				ptset.bookobj.loads.text.copyright[1] = a.value;
				break;
			case "ptdate":
				ptset.bookobj.loads.text.date[1] = a.value;
				break;
			case "het":
				p(a);
				break;
			case "wid":
				p(a);
				break;
			case "dpi":
				/^\d+$/.test(a.value) && (rda.checked ? ptset.bookobj.dpi = parseInt(dpi.value) : ptset.bodyobj.dpi = parseInt(dpi.value), upchang(pgs));
				break;
			case "brcode":
				B(a);
				break;
			case "brsize":
				B(a);
				break;
			case "brcolor":
				B(a);
				break;
			case "brwh":
				B(a);
				break;
			case "qrcode":
				E(a);
				break;
			case "qrwh":
				E(a);
				break;
			case "qrcolor":
				E(a);
				break;
			case "qrrx":
				E(a);
				break;
			case "picpath":
				imgpath = wpyt.value + "?img\x3d" + a.value;
				u();
				break;
			case "imgp":
				tbodyimg.value = a.value ? a.value + "/" : "";
				ptset.bodyobj.path[2] = "\u9ed8\u8ba4\u5b57\u4f53" == a.value ? "" : "images/";
				upchang(tbodyimg);
				if (window.setimgwind) {
					var r = document.createEvent("MouseEvents");
					r.initEvent("dblclick", !1, !0);
					tbodyimg.dispatchEvent(r)
				}
				break;
			case "txtp":
				tbodytxt.value = a.value ? a.value + "/" : "";
				ptset.bodyobj.path[0] = "\u9ed8\u8ba4\u5b57\u4f53" == a.value ? "" : "text/";
				upchang(tbodytxt);
				window.setimgwind && (r = document.createEvent("MouseEvents"), r.initEvent("dblclick", !1, !0), tbodytxt.dispatchEvent(r));
				break;
			case "fntp":
				a.value && setfont(a.value, a.options[a.selectedIndex].innerHTML);
				break;
			case "retp":
				tbodyret.value = a.value ? a.value + "/" : "",
				ptset.bodyobj.path[1] = "\u9ed8\u8ba4\u5b57\u4f53" == a.value ? "" : "reptxt/",
				upchang(tbodyret),
				window.setimgwind && (r = document.createEvent("MouseEvents"), r.initEvent("dblclick", !1, !0), tbodyret.dispatchEvent(r))
			}
		} catch (F) {
			errtxt.innerHTML = F
		}
	},
	n = function (a) {
		errtxt.innerHTML = "";
		try {
			switch (a.id) {
			case "rptcel":
				ptset.bodyobj.flag.cel = a.checked;
				break;
			case "rptpage":
				rda.checked ? ptset.bookobj.height[1] = a.checked : ptset.bodyobj.height[1] = a.checked;
				break;
			case "rptpgidx":
				ptset.bodyobj.flag.pageidx = a.checked ? 2 : 0;
				break;
			case "rptbk":
				ptset.bodyobj.flag.bk = a.checked;
				break;
			case "rptbkT":
				ptset.bodyobj.flag.Tbk = a.checked;
				break;
			case "rptag":
				ptset.bodyobj.flag.tag = a.checked;
				break;
			case "rptwat":
				ptset.bodyobj.flag.pagewat = a.checked;
				break;
			case "rpttbk":
				ptset.bodyobj.flag.txtbk = a.checked;
				break;
			case "rpttxt":
				ptset.bodyobj.flag.txtbox = a.checked;
				break;
			case "rptptxt":
				ptset.bodyobj.flag.picbox = a.checked;
				break;
			case "rptname":
				ptset.bookobj.loads.text.name[4] = a.checked;
				break;
			case "rptauthor":
				ptset.bookobj.loads.text.author[4] = a.checked;
				break;
			case "rptcopyright":
				ptset.bookobj.loads.text.copyright[4] = a.checked;
				break;
			case "rptdate":
				ptset.bookobj.loads.text.date[4] = a.checked;
				break;
			case "mrrorbk":
				try {
					localStorage.mrrorbk = a.checked ? "1" : "0"
				} catch (d) {}

			}
		} catch (d) {
			errtxt.innerHTML = d
		}
	},
	t = null,
	y = function () {
		for (var a = document.getElementsByName("cktxt"), d = 0, b = 0; b < a.length; b++)
			d += a[b].checked ? 1 << b : 0;
		try {
			ptset.bodyobj.tcn = localStorage.tcnflg = d
		} catch (J) {
			ptset.bodyobj.tcn = d
		}
	},
	O = function (a) {
		errtxt.innerHTML = "";
		try {
			switch (a.id) {
			case "expobj":
				"block" == jsoneditor.style.display && (ptset = editor.get(), u());
				down("ptset.json", JSON.stringify(ptset));
				break;
			case "exppage":
				exppageout();
				break;
			case "saveobj":
				try {
					localStorage.ptset = JSON.stringify(ptset);
					alert("\u5df2\u4fdd\u5b58\u5f53\u524d\u914d\u7f6e\u5230\n\u672c\u5730localStorage\u4e2d!");
					saveobj.value = "\ud83d\udcb9";
					saveobj.style.backgroundColor = "#f00";
					return
				} catch (z) {
					alert("\u6b64\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u672c\u5730localStorage!\u5b58\u50a8\n\u9875\u9762\u5173\u95ed\u540e\u5931\u6548\u8bf7\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u4fdd\u5b58")
				}
				break;
			case "reobj":
				if (confirm("\u6e05\u7a7a\u4fdd\u5b58\u914d\u7f6e\u8fd8\u539f\u9ed8\u8ba4???"))
					try {
						localStorage.ptset = "",
						localStorage.tcnflg = ""
					} catch (z) {}

				break;
			case "splitimg":
				geturl("pnum\x3d" + saveImgPath + ptname.value + "/", function (a) {
					"-" == a[0] ? alert("\u6587\u4ef6\n" + a + " \n\u4e3a\u5355\u9875\u56fe\u7247\u4e0d\u53ef\u62c6\u5206") : (a = a.replace(/[^\d]+,/g, ""), a = eval("[" + a + "]"), a.sort(function (a, d) {
							return a - d
						}), 2 > a.length ? alert("\u9875\u9762\u603b\u6570\u4e3a" + a.length + "\n\u4e0d\u591f\u4e00\u5f20\u7eb8\u5408\u5e76") : (pidx = parseInt(a[0]), pagepdf[0] = pidx ? a.length : a.length - 1, a = ptname.value + fliespt + pagepdf[0] + ".png", kaisu.value = "2", upfile(a, 0, 2)))
				});
				break;
			case "loadobj":
				g(openfile, a);
				break;
			case "loadpage":
				g(openfile, a);
				break;
			case "loadtxt":
				g(openfile, a);
				break;
			case "loadurltxt":
				g(openfile, a);
				break;
			case "reloadtxt":
				afg = bfg = 1;
				tdh = tlh = thy = tflg = 0;
				ptset.bodyobj.txt = lput.value = conftxt(otxt);
				break;
			case "loadurltxtlast":
				lput.value = "",
				uptxtfile(txtpath.value, utindex, usize.value);
			case "mdbkname":
				a.innerHTML = "\u2611\ufe0f" == a.innerHTML ? "\ud83d\udd32" : "\u2611\ufe0f";
				if ("\u2611\ufe0f" == a.innerHTML) {
					var d = prompt("\u8bf7\u8f93\u5165\u7f1d\u7ebf\u5185\u663e\u793a\u4e66\u540d\u7684\u80cc\u666f\u989c\u8272,\u6587\u5b57\u989c\u8272", (ptset.bookobj.loads.text.midname[3][0] || ptset.bookobj.loads.text.midauthor[3][0]) + "," + (ptset.bookobj.loads.text.midname[5][0] || ptset.bookobj.loads.text.midauthor[5][0]));
					/#[0-9a-fA-F]{3,},/.test(d) && confirm("\u663e\u793a\u4e66\u540d\u786e\u8ba4???") && (ptset.bookobj.loads.text.midname[1] = ptname.value, ptset.bookobj.loads.text.midauthor[1] = ptauthor.value.replace(/=/, "\u25bc"), d = d.split(","), ptset.bookobj.loads.text.midname[3][0] = d[0], ptset.bookobj.loads.text.midauthor[3][0] = d[0], d[1] && (ptset.bookobj.loads.text.midname[5][0] = d[1], ptset.bookobj.loads.text.midauthor[5][0] = d[1], ptset.bookobj.loads.text.midname[5][1] = "#FFF0", ptset.bookobj.loads.text.midauthor[5][1] = "#FFF0"))
				} else
					ptset.bookobj.loads.text.midname[1] = "", ptset.bookobj.loads.text.midauthor[1] = "";
				break;
			case "loadback":
				if (confirm("\u52a0\u8f7d\u5907\u4efd\u64cd\u4f5c\u786e\u8ba4???")) {
					a.innerHTML = "\u2611\ufe0f" == a.innerHTML ? "\ud83d\udd32" : "\u2611\ufe0f";
					"\u2611\ufe0f" != a.innerHTML || ptset.setback & 1 ? ptset.setback & 1 && --ptset.setback : ptset.setback += 1;
					try {
						localStorage.setback = ptset.setback
					} catch (z) {}

				}
				break;
			case "debugzero":
				a.innerHTML = "\u2611\ufe0f" == a.innerHTML ? "\ud83d\udd32" : "\u2611\ufe0f";
				autoflg = "\u2611\ufe0f" == a.innerHTML ? 1 : 0;
				try {
					localStorage.debugzero = autoflg
				} catch (z) {}

				break;
			case "debugtxt":
				a.innerHTML = "\u2611\ufe0f" == a.innerHTML ? "\ud83d\udd32" : "\u2611\ufe0f";
				var b = [];
				"\u2611\ufe0f" == a.innerHTML && (b = [lput.value, mput.value, rput.value, pyput.value, coverpytxtflg.value]);
				try {
					localStorage.debugtxt = JSON.stringify(b)
				} catch (z) {}

				break;
			case "autoback":
				if (confirm("\u81ea\u52a8\u4fdd\u5b58\u64cd\u4f5c\u786e\u8ba4???")) {
					a.innerHTML = "\u2611\ufe0f" == a.innerHTML ? "\ud83d\udd32" : "\u2611\ufe0f";
					"\u2611\ufe0f" != a.innerHTML || ptset.setback & 2 ? ptset.setback & 2 && (ptset.setback -= 2) : ptset.setback += 2;
					try {
						localStorage.setback = ptset.setback
					} catch (z) {}

				}
				break;
			case "cktxtp":
				b = document.getElementsByName("cktxt");
				a.innerHTML = "\u2611\ufe0f" == a.innerHTML ? "\ud83d\udd32" : "\u2611\ufe0f";
				for (var e = "\u2611\ufe0f" == a.innerHTML ? 1 : 0, d = 0; d < b.length; d++)
					b[d].checked = e;
				y();
				break;
			case "listpage":
				a.innerHTML = "\u2611\ufe0f" == a.innerHTML ? "\ud83d\udd32" : "\u2611\ufe0f";
				break;
			case "book3dk":
				a.innerHTML = "\u2611\ufe0f" == a.innerHTML ? "\ud83d\udd32" : "\u2611\ufe0f";
				break;
			case "covertxt":
				y(),
				lput.value = machtxt(lput.value, machflg())
			}
		} catch (z) {
			errtxt.innerHTML = z
		}
		t && (t.style.backgroundColor = t.style.color = t.style.fontWeight = "");
		"button" == a.type && (a.style.backgroundColor = "#ff0", a.style.color = "#F00", a.style.fontWeight = "bold", t = a)
	},
	D = function (a, d) {
		for (var b = 0, e = 0; e < a.options.length; e++)
			if (a.options[e].innerHTML == d) {
				b = e;
				break
			}
		return b
	},
	B = function () {
		if (brcode.value) {
			if (/DXGJ_[A-Z]+_/.test(brcode.value)) {
				var a = brcode.value.match(/(DXGJ_[A-Z]+_)/)[1];
				brcode.value = brcode.value.replace(a, bookTypeBrcode[a])
			}
			errtxt.innerHTML = "";
			var a = eval("[" + brwh.value + "]"),
			d = brcolor.value.split(",");
			try {
				JsBarcode("#brcodeimg", brcode.value, {
					format : "EAN13",
					displayValue : !0,
					fontSize : parseInt(brsize.value),
					width : a[0],
					height : a[1],
					background : colorint(d[1]),
					lineColor : colorint(d[0])
				})
			} catch (w) {
				errtxt.innerHTML = w
			}
		} else
			ptset.bookobj.box.brbox[2][1] = ""
	},
	E = function () {
		if (qrcode.value) {
			errtxt.innerHTML = "";
			var a = eval("[" + qrwh.value + "]"),
			d = qrcolor.value.split(",");
			try {
				new QRCode(ByID("qrcodeimg"), {
					width : a[0],
					height : a[1],
					text : qrcode.value,
					framecolor : d[2],
					framewidth : a[2],
					typeNumber : a[3],
					colorDark : colorint(d[1]),
					colorLight : colorint(d[0]),
					correctLevel : parseInt(qrrx.value)
				})
			} catch (w) {
				errtxt.innerHTML = w
			}
		} else
			ptset.bookobj.box.qrbox[2][1] = ""
	},
	P = function (a, d) {
		ptset.page[d].w = a[0];
		ptset.page[d].h = a[1];
		rda.checked ? ptset.bookobj.page = d : ptset.bodyobj.page = d
	};
	rda.onchange = function (a) {
		a = D(pgs, ptset.bookobj.page);
		pgs.selectedIndex = a;
		upchang(pgs)
	};
	rdb.onchange = function (a) {
		a = D(pgs, ptset.bodyobj.page);
		pgs.selectedIndex = a;
		upchang(pgs)
	};
	tda.onchange = tdb.onchange = function (a) {
		ptset.bodyobj.setmode = Number(this.value)
	};
	fmpl.onchange = function (a) {
		ptset.bookobj.modeflg = this.value;
		K(this.value)
	};
	fda.onchange = function (a) {
		ptset.bookobj.setmode = Number(fda.value);
		ptset.bookobj.box.imagebox1[0] = ["0", -41, "x-fex/2", .5];
		ptset.bookobj.box.qrbox[0] = [10, "H-d[3]", 40, 40];
		ptset.bookobj.box.brbox[0] = ["w-d[2]-fex/2", -40, 100, 40];
		ptset.bookobj.loads.box.datebox[0] = ["0", "H-d[3]", 10, 40];
		ptset.bookobj.loads.box.copyrightbox[0] = ["0", "H-d[3]", "x-fex/2", 40];
		ptset.bookobj.loads.text.copyright[0] = [90, 1, 60, 1, -2, 2];
		ptset.bookobj.text.htxt[0] = ["w*0.15", 20, "x*0.7", "h/2", 2, 1];
		ptset.bookobj.text.wtxt[0] = ["w*0.05", 20, "x*0.8", "h+20", -10, 2];
		ptset.bookobj.text.htxt2[0] = ["w+fex/2", "h/3", 120, "h", 2, 2];
		ptset.bookobj.text.wtxt2[0] = ["w", -15, "x", 10, -10, 2];
		fmpl.value = "R";
		setTimeout(function () {
			upchang(fmpl)
		}, 500)
	};
	fdb.onchange = function (a) {
		ptset.bookobj.setmode = Number(fdb.value);
		ptset.bookobj.box.imagebox1[0] = ["X+fex/2", -41, "x", .5];
		ptset.bookobj.box.qrbox[0] = [-10, "H-d[3]", 40, 40];
		ptset.bookobj.box.brbox[0] = ["X+fex/2", -40, 100, 40];
		ptset.bookobj.loads.box.datebox[0] = ["W-d[2]", "H-d[3]", 10, 40];
		ptset.bookobj.loads.box.copyrightbox[0] = ["X+fex/2", "H-d[3]", "x-fex/2", 40];
		ptset.bookobj.loads.text.copyright[0] = [10, 1, 60, 1, -2, 2];
		ptset.bookobj.text.htxt[0] = ["w*0.2 + w", 20, "x*0.7", "h/2", 2, 1];
		ptset.bookobj.text.wtxt[0] = ["w*0.15 + w", 20, "x*0.8", "h+20", -10, 2];
		ptset.bookobj.text.htxt2[0] = ["w-fex/2-120", "h/3", 120, "h", 2, 2];
		ptset.bookobj.text.wtxt2[0] = [0, -15, "x", 10, -10, 2];
		fmpl.value = "l";
		setTimeout(function () {
			upchang(fmpl)
		}, 500)
	};
	rmerge.onchange = function (a) {
		ptset.bodyobj.pagemerge = 0;
		repsetex()
	};
	lmerge.onchange = function (a) {
		ptset.bodyobj.pagemerge = 1;
		repsetex()
	};
	pgs.onmousedown = function (a) {
		this.value = ""
	};
	pgs.onchange = function (a) {
		a = eval("[" + this.value + "]");
		wid.value = a[0];
		het.value = a[1];
		canvs.width = a[0] * mmpx;
		canvs.height = a[1] * mmpx;
		P(a, this.options[this.selectedIndex].innerHTML);
		dpi.value = rda.checked ? ptset.bookobj.dpi : ptset.bodyobj.dpi;
		rptpage.checked = rda.checked ? ptset.bookobj.height[1] : ptset.bodyobj.height[1]
	};
	gotopng.onclick = function (a) {
		(a = prompt("\u8bf7\u8f93\u5165\u8df3\u8f6c\u9875\u9762\u9875\u7801\u6570", gotopng.value)) && /^\d+$/.test(a) ? (click_error()) : alert("\u8f93\u5165\u9519\u8bef")
	};
	bookIndexbtn.onclick = function (a) {
		this.value = "\u2611\u76ee\u5f55\u7d22\u5f15";
		var d = bookIndex.value.replace(/^[,\s]|[,\s]$/g, ""),
		d = d.split("\n");
		a = [];
		for (var b = 0; b < d.length; b++) {
			var e = d[b].split(":"),
			f = parseInt(e[0]),
			g = e[2];
			a.push(["\u7b2c%R\u22956" + ("000" + (f + ("\u5de6" == e[1] ? 0 : 1))).match(/.*(.{3})$/)[1] + "%\u22959\u9875", g])
		}
		d = "";
		for (b = 0; b < a.length; b++)
			d += "\u2756" + a[b][0] + "\ufe19\ufe19\ufe19" + a[b][1] + "$";
		lput.value = d;
		rptpgidx.checked = !1;
		upchang(rptpgidx);
		txtReg = /[\ud840-\ud888]*[0-9\u3400-\uFAD9]/;
		a = document.createEvent("MouseEvents");
		a.initEvent("click", !1, !0);
		ptbody.dispatchEvent(a)
	};
	ptallpng.onclick = function (a) {
		autopng.checked = !0;
		autoflg = 1;
		a = document.createEvent("MouseEvents");
		a.initEvent("click", !1, !0);
		ptbook.dispatchEvent(a)
	};
	ptallpdf.onclick = function (a) {
		autopage.checked = !0;
		autoflg = 1;
		a = document.createEvent("MouseEvents");
		a.initEvent("click", !1, !0);
		ptbook.dispatchEvent(a)
	};
	rebody.onclick = function (a) {
		if (predoc) {
			predoc[4] || (a = ptset.bodyobj.tbr, thy == a[4] && (lput.value = a[5] + lput.value), thy == a[5] && (lput.value = a[4] + lput.value));
			var d = 0;
			a = "afg,bfg,tdh,tlh,thy,tflg,lastflg,imgid,lput.value,rput.value,mput.value,pagepdf[0],pyput.value,".replace(/,/g, function (a) {
					a = "\x3dpredoc[" + d + "];";
					d++;
					return a
				});
			eval(a)
		} else
			CZTlist = 0
	};
	ptstop.onclick = function (a) {
		prcstop = 1
	};
	ptbook.onclick = function (a) {
		prcstop ? (lock = prcstop = 0, alert("\u64cd\u4f5c\u53d6\u6d88!!!")) : lock || (lock = 1, h() ? (rda.checked = !0, upchang(rda), "\u2611\ufe0f" == mdbkname.innerHTML && (ptset.bookobj.loads.text.midname[1] = ptname.value, ptset.bookobj.loads.text.midauthor[1] = ptauthor.value.replace(/=/, "\u25bc")), setTimeout(function () {
					fliespt = "#_";
					onbook()
				})) : alert("\u8bf7\u5148\u542f\u52a8WEB\u670d\u52a1\u5668"))
	};
	ptbody.onclick = function (a) {
		if (prcstop)
			lock = prcstop = 0, alert("\u64cd\u4f5c\u53d6\u6d88!!!");
		else if (Tlist && CZTlist)
			onbody();
		else if (lput.value && !lock)
			if (lock = 1, "null" == pagepdf[0] && (pagepdf[0] = pidx), h()) {
				if (lastflg && !autopage.checked && !autopng.checked){
					if (lock = 0, "\u2611\ufe0f\u6279\u91cf" == autotb.value || readsrt.length || confirm("\u662f\u5426\u52a0\u8f7d\u4e0b\u4e00\u9875\u9762?")) {
						if ("object" === typeof predoc[predoc.length - 1]) {
							var d = bookspath + ptset.bookobj.loads.text.name[1] + "/" + (predoc[11] + 1) + ".txt";
							"\u2611\ufe0f" == loadback.innerHTML && uptxtfile(d, 0, 0, function (a) {
								/\[(\d+,){4}/.test(a[1]) ? (predoc = JSON.parse(a[1]), conftxt("[config]" + predoc[predoc.length - 1][1] + "[config]"), message("\u63d0\u793a", "\u5f53\u524d\u9875\u9762\u6587\u4ef6\u4e3a:\x3cbr/\x3e" + d, 8), MCk(rebody)) : message("\u63d0\u793a", "\u5f53\u524d\u9875\u9762\u6587\u4ef6\u4e3a:\x3cbr/\x3e" + d + "\x3cbr/\x3e\u6253\u5f00\u5931\u8d25;\u52a0\u8f7d\u5f53\u524d\u6587\u6863", 8)
							})
						}
					} else
						return;

				}
				rdb.checked = !0;
				upchang(rdb);
				predoc = [afg, bfg, tdh, tlh, thy, tflg, lastflg, imgid, lput.value, rput.value, mput.value, pagepdf[0], pyput.value];
				setTimeout(function () {
					lastflg = 0;
					fliespt = "#-";
					ptset.bodyobj.pic.imgtxt = mput.value;
					ptset.bodyobj.txt = lput.value;
					ptset.bodyobj.ret = rput.value;
					ptset.bodyobj.pytxt = pyput.value;
					onbody()
				})
			} else
				alert("\u8bf7\u5148\u542f\u52a8WEB\u670d\u52a1\u5668")
	};
	rput.oncontextmenu = lput.oncontextmenu = function (a) {};
	lput.onmouseup = function (a) {
		this.oncontextmenu = null;
		if (a.altKey && "2" == a.button) {
			this.oncontextmenu = function (a) {
				return !1
			};
			var d = document.createEvent("MouseEvents");
			d.initEvent("dblclick", !1, !0);
			tbodyimg.dispatchEvent(d)
		}
		a.ctrlKey && "2" == a.button && (this.oncontextmenu = function (a) {
			return !1
		}, a = getLocation(this), d = geteLocation(this), a == d ? (setLocation(this, a, a + this.value.gtxg(a)), d = "," + a + "\x3d" + retp.value + "/" + this.value.gtxt(a)) : d = "," + this.value.gtxt(a) + "\x3d" + retp.value + "/" + this.value.gtxt(a), a = prompt("\u8bf7\u8f93\u5165\u66ff\u6362\u56fe\u7247\u540d,\n\u9009\u62e9\u6587\u5b57\u5e8f\u53f7:" + a + "\n\u9009\u62e9\u6587\u5b57\u5185\u5bb9:" + this.value.gtxt(a), d), /^,[^=]+=[^,=]+$/.test(a) && rtest(a))
	};
	rput.onmouseup = function (a) {
		this.oncontextmenu = null;
		if (a.ctrlKey && "2" == a.button) {
			this.oncontextmenu = function (a) {
				return !1
			};
			for (var d = getLocation(this), b = this.value, e = 0, f = d; f < b.length && "," != b.charAt(f); f++)
				e++;
			a = d + e;
			e = 0;
			for (f = d; 0 <= f && "," != b.charAt(f); f--)
				e++;
			d = d - e + 1;
			setLocation(this, d, a);
			b = b.substring(d, a);
			e = b.split("\x3d");
			f = e[1].split("/");
			b = prompt("\u8bf7\u8f93\u5165\u66ff\u6362\u56fe\u7247\u540d\n\u9009\u62e9\u6587\u5b57\u5185\u5bb9:" + b, e[0] + "\x3d" + retp.value + "/" + f[f.length - 1]);
			/^[^=]+=[^,=]+$/.test(b) && (this.value = this.value.del(d, a - d), this.value = this.value.splice(d, b))
		}
	};
	var L = function () {
		ptfengx.value = ptset.bookobj.fengx + "," + ptset.bookobj.box.imagebox4[1] + "," + ptset.bookobj.box.imagebox3[1];
		1700 > ByID("set").offsetWidth && (ffid.style.fontSize = "12px;");
		ptname.value = ptset.bookobj.loads.text.name[1];
		ptauthor.value = ptset.bookobj.loads.text.author[1];
		ptcopyright.value = ptset.bookobj.loads.text.copyright[1];
		ptdate.value = ptset.bookobj.loads.text.date[1];
		lput.value = ptset.bodyobj.txt ? ptset.bodyobj.txt : lput.value;
		pyput.value = ptset.bodyobj.pytxt ? ptset.bodyobj.pytxt : pyput.value;
		rput.value = ptset.bodyobj.ret ? ptset.bodyobj.ret : rput.value;
		lput.value = lput.value.replace(/^\s+|\s+$|\r*\n+/g, "");
		rput.value = rput.value.replace(/^\s+|\s+$|\r*\n+/g, "");
		mput.value = ptset.bodyobj.pic.imgtxt ? ptset.bodyobj.pic.imgtxt : mput.value;
		mput.value = mput.value.replace(/^\s+|\s+$|\r*\n+/g, "");
		mput.value = mput.value.replace(/;/g, ";\n");
		tbookpic.value = ptset.bookobj.bkpic[1][1];
		tbackpic.value = ptset.backimage[1];
		tbookht.value = ptset.bookobj.height[0];
		ptwat.value = ptset.bodyobj.wat.atxt.and[2];
		tbodyht.value = ptset.bodyobj.height[0];
		tbodytxt.value = ptset.bodyobj.subpath[0];
		tbodyret.value = ptset.bodyobj.subpath[1];
		tbodyimg.value = ptset.bodyobj.subpath[2];
		tbodypic.value = ptset.bodyobj.bkpic[1][1];
		tbodybk.value = "string" === typeof ptset.bodyobj.bk.tbt[0][1] ? ptset.bodyobj.bk.tbt[0][1] : tbodybk.value;
		tbodycel.value = "string" === typeof ptset.bodyobj.col.clt[1][1] ? ptset.bodyobj.col.clt[1][1] : tbodycel.value;
		try {
			var a = localStorage ? localStorage.setrandcls ? eval("[" + localStorage.setrandcls + "]") : null : null;
			uflg = ptset.bodyobj.trand = a[0];
			ptset.bodyobj.col.cls = a[1];
			ptset.setline["n" + a[1]] && eval(ptset.setline["n" + a[1]].replace(/[\r\n\t]/g, ""))
		} catch (l) {}

		tbodyrand.value = ptset.bodyobj.trand;
		tbodycelnum.value = ptset.bodyobj.col.cls;
		ttxtcel.value = ptset.bodyobj.col.tlt[1][1];
		book3d.value = ptset.bookobj.bk3d;
		cosimg1.value = ptset.bookobj.box.imagebox0[1];
		cosimg3.value = ptset.bookobj.box.imagebox1[1];
		cosimg2.value = ptset.bookobj.box.imagebox01[0][2] + "," + ptset.bookobj.box.imagebox01[1];
		costxt1.value = ptset.bookobj.text.wtxt[1];
		costxt2.value = ptset.bookobj.text.wtxt2[1];
		costxt3.value = ptset.bookobj.text.htxt[1];
		costxt4.value = ptset.bookobj.text.htxt2[1];
		version.value = (ptset.bookobj.text.versionL[1] || ptset.bookobj.text.versionR[1]) + "," + (ptset.bookobj.box.cealcopyboxL[2][1] || ptset.bookobj.box.cealcopyboxR[2][1]) + ",";
		version.value = version.value.replace(/_[rl]\.([jpegnif]{3,4}),$/, ".$1,");
		ptset.bookobj.box.cealcopyboxL[2][1] && (version.value += "L");
		ptset.bookobj.box.cealcopyboxR[2][1] && (version.value += "R");
		ptset.bookobj.box.cealcopyboxM[2][1] && (version.value += "M");
		backpic.value = recolor(ptset.backcolor);
		bookpic.value = recolor(ptset.bookobj.bkpic[2]);
		bodypic.value = recolor(ptset.bodyobj.bkpic[2]);
		bodybk.value = recolor(ptset.bodyobj.bk.tbc[0]);
		bodycel.value = recolor(ptset.bodyobj.col.clt[0][0]);
		txtcel.value = recolor(ptset.bodyobj.col.tlt[0]);
		txtfc.value = recolor(ptset.bodyobj.color[0]);
		txtbc.value = recolor(ptset.bodyobj.color[1]);
		txtpfc.value = recolor(ptset.bodyobj.pcolor[0]);
		txtpbc.value = recolor(ptset.bodyobj.pcolor[1]);
		ptset.backcolor && upchang(backpic);
		ptset.bookobj.bkpic[2] && upchang(bookpic);
		ptset.bodyobj.bkpic[2] && upchang(bodypic);
		ptset.bodyobj.bk.tbc[0] && upchang(bodybk);
		ptset.bodyobj.col.clt[0][0] && upchang(bodycel);
		ptset.bodyobj.col.tlt[0] && upchang(txtcel);
		ptset.bodyobj.color[0] && upchang(txtfc);
		ptset.bodyobj.color[1] && upchang(txtbc);
		ptset.bodyobj.pcolor[0] && upchang(txtpfc);
		ptset.bodyobj.pcolor[1] && upchang(txtpbc);
		rptcel.checked = ptset.bodyobj.flag.cel;
		rptbk.checked = ptset.bodyobj.flag.bk;
		rptag.checked = ptset.bodyobj.flag.tag;
		rptbkT.checked = ptset.bodyobj.flag.Tbk;
		rptwat.checked = ptset.bodyobj.flag.pagewat;
		rpttxt.checked = ptset.bodyobj.flag.txtbox;
		rptptxt.checked = ptset.bodyobj.flag.picbox;
		rpttbk.checked = ptset.bodyobj.flag.txtbk;
		rptpgidx.checked = ptset.bodyobj.flag.pageidx;
		rptpage.checked = rda.checked ? ptset.bookobj.height[1] : ptset.bodyobj.height[1];
		rptname.checked = ptset.bookobj.loads.text.name[4];
		rptauthor.checked = ptset.bookobj.loads.text.author[4];
		rptcopyright.checked = ptset.bookobj.loads.text.copyright[4];
		rptdate.checked = ptset.bookobj.loads.text.date[4];
		txtpath.value = bookspath;
		picpath.value = oldpath;
		code.style.height = txtpfc.offsetTop + txtpfc.offsetHeight + "px";
		qrcodeimg.onload = function (a) {
			ptset.bookobj.box.qrbox[2][1] = qrcodeimg.src
		};
		brcodeimg.onload = function (a) {
			ptset.bookobj.box.brbox[2][1] = brcodeimg.src
		};
		var a = ptset.page,
		a = Object.entries(a),
		d;
		for (d in a)
			"info" != a[d][0] && pgs.options.add(new Option(a[d][0], a[d][1].w + "," + a[d][1].h));
		kaisu.options.add(new Option("\u4e0d\u62c6\u5f00", 0));
		kaisu.options.add(new Option("\u53ea\u62c6\u5f00", 1));
		kaisu.options.add(new Option("\u63d0\u793a\u9009\u62e9", 2));
		kaisu.options.add(new Option("\u81ea\u52a8\u8fd0\u7b97", 3));
		for (d = 4; 257 > d; d += 4)
			kaisu.options.add(new Option(d + "\u5f00\u5408\u5e76", d));
		kaisu.value = parseInt(ptset.bodyobj.pagespt[0]);
		pgs.selectedIndex = D(pgs, ptset.page.info);
		upchang(pgs);
		B();
		E();
		txtp.options.add(new Option("\u9ed8\u8ba4\u76ee\u5f55", ""));
		retp.options.add(new Option("\u9ed8\u8ba4\u76ee\u5f55", ""));
		imgp.options.add(new Option("\u9ed8\u8ba4\u76ee\u5f55", ""));
		txtp.options.add(new Option("\u9ed8\u8ba4\u5b57\u4f53", "\u9ed8\u8ba4\u5b57\u4f53"));
		retp.options.add(new Option("\u9ed8\u8ba4\u5b57\u4f53", "\u9ed8\u8ba4\u5b57\u4f53"));
		imgp.options.add(new Option("\u9ed8\u8ba4\u5b57\u4f53", "\u9ed8\u8ba4\u5b57\u4f53"));
		var b = function (a, d, b) {
			b = b.split(",");
			for (var e in b)
				b[e] && a.options.add(new Option(b[e], b[e]));
			ptset.bodyobj.subpath[d] ? a.value = ptset.bodyobj.subpath[d].replace("/", "") : a.selectedIndex = 0;
			ptset.bodyobj.path[d] || (a.value = "\u9ed8\u8ba4\u5b57\u4f53");
			upchang(a)
		},
		e = function (a) {
			if (ptset.bodyobj.setpath[0])
				b(txtp, 0, ptset.bodyobj.setpath[0]);
			else if (a) {
				var d = "subpath\x3d" + oldpath + "body/text/";
				geturl(d, function (a) {
					b(txtp, 0, a)
				})
			}
			ptset.bodyobj.setpath[1] ? b(retp, 1, ptset.bodyobj.setpath[1]) : a && (d = "subpath\x3d" + oldpath + "body/reptxt/", geturl(d, function (a) {
					b(retp, 1, a)
				}));
			ptset.bodyobj.setpath[2] ? b(imgp, 2, ptset.bodyobj.setpath[2]) : a && (d = "subpath\x3d" + oldpath + "body/images/", geturl(d, function (a) {
					b(imgp, 2, a)
				}));
			var e = [bkp1, bkp2, bkp3, bkp4, bkp5, bkp6, bkp7, bkp8];
			for (a = 0; a < e.length; a++)
				0 > e[a].innerHTML.indexOf("\u9ed8\u8ba4\u5b57\u4f53") && (e[a].options.add(new Option("\u9ed8\u8ba4\u5b57\u4f53", "")), e[a].options.add(new Option("\u9501\u5b9a\u672c\u5730", "")));
			var f = [ptset.bookobj.loads.text.name, ptset.bookobj.loads.text.author, ptset.bookobj.loads.text.copyright, ptset.bookobj.loads.text.date, ptset.bookobj.text.wtxt, ptset.bookobj.text.wtxt2, ptset.bookobj.text.htxt, ptset.bookobj.text.htxt2],
			d = "subpath\x3d" + oldpath + "book/data/";
			geturl(d, function (a) {
				a = a.split(",");
				for (var d in a)
					0 < e[3].innerHTML.indexOf("data/" + a[d] + "/") || a[d] && e[3].options.add(new Option("data/" + a[d] + "/", "data/" + a[d] + "/"));
				geturl("subpath\x3d" + oldpath + "book/", function (a) {
					for (var d = 0; d < e.length; d++) {
						for (var b in fntp.options)
							fntp.options[b].innerHTML && "\u5b57\u4f53" != fntp.options[b].innerHTML && (a += "/" + fntp.options[b].innerHTML + ",");
						var w = a.split(",");
						for (b in w)
							"data" != w[b] && (0 < e[d].innerHTML.indexOf(w[b] + "/") || w[b] && e[d].options.add(new Option(w[b] + "/", w[b] + "/")));
						e[d].value = f[d][2];
						e[d].onchange = function (a) {
							a.stopPropagation();
							a = parseInt(this.id.replace("bkp", "")) - 1;
							f[a][2] = this.value;
							if (0 > this.value.indexOf("#*#")) {
								var d = D(this, "\u9501\u5b9a\u672c\u5730");
								this.options[d].value = this.value + "#*#";
								2 == uflg && (d = this.value.replace(/\//g, ""), fontlist[d] && (0 == a && (ptset.bookobj.font.name[0] = ptset.bookobj.font.name[0].replace(/px\s.+/, "px " + fontlist[d][0]), ptset.bookobj.font.midname[0] = ptset.bookobj.font.midname[0].replace(/px\s.+/, "px " + fontlist[d][0])), 1 == a && (ptset.bookobj.font.author[0] = ptset.bookobj.font.author[0].replace(/px\s.+/, "px " + fontlist[d][0])), 2 == a && (ptset.bookobj.font.copyright[0] = ptset.bookobj.font.copyright[0].replace(/px\s.+/, "px " + fontlist[d][0])), 6 == a && (ptset.bookobj.font.htxt[0] = ptset.bookobj.font.htxt[0].replace(/px\s.+/, "px " + fontlist[d][0]))))
							}
						};
						document.getElementById("skp" + d) || (w = document.createElement("span"), w.innerHTML = "\u2699", w.id = "skp" + d, e[d].parentNode.insertBefore(w, e[d].nextElementSibling), w.onclick = function (a) {
							a.stopPropagation();
							a = parseInt(this.id.replace("skp", ""));
							var d = prompt("\u8bf7\u8f93\u5165\u80cc\u666f\u989c\u8272,\n\u662f\u5426\u5e73\u5206\u95f4\u8ddd[0,1],\n\u5bf9\u9f50\u65b9\u5f0f[0,1,2]\n\u6587\u5b57\u524d\u666f\u989c\u8272\n\u6587\u5b57\u80cc\u666f\u989c\u8272\n\u6587\u5b57\u80cc\u666f\u900f\u660e[0,4](0\u4e3a\u9600\u503c\u900f\u660e\u56fe\u7247\n1\u4e3a\u9875\u9762\u56fe\u7247\u989c\u8272\u9600\u503c\u53c2\u6570\u900f\u660e\u56fe\u7247\uff0c\n2\u4e3a\u9875\u9762\u5b57\u4f53\u989c\u8272\u9600\u503c\u53c2\u6570\u900f\u660e\u56fe\u7247\uff0c\n3NULL\u4e0d\u5904\u7406\n4\u5b57\u4f53\u672c\u8eab\u900f\u660e\u76f4\u63a5\u52a0\u8f7d\u4e0d\u5904\u7406\n\u9600\u503c\u900f\u660e\u4f1a\u6709\u566a\u70b9\uff0c\u7070\u5ea6\u900f\u660e\u4f1a\u6709\u6a21\u7cca)", JSON.stringify(f[a][3]) + JSON.stringify(f[a][5]));
							d && (/^(\[[#0-9a-fA-F"]*,[#0-9a-fA-F"]*,[#0-4]*\]){2}$/.test(d) ? (d = d.split("]"), f[a][3] = JSON.parse(d[0] + "]"), f[a][5] = JSON.parse(d[1] + "]")) : alert("\u8f93\u5165\u9519\u8bef!!"))
						})
					}
				})
			})
		};
		setimg.setAttribute("crossOrigin", "anonymous");
		setimg.src = (infopath + "set.png").match(/get.php\?img=(.+)/)[1];
		setimg.onerror = function (a) {
			if(setimg.title !== "set.png"){
				setimg.src = "images/info/set.png";
				setimg.title = "set.png";
				e(0);
			}
		};
		setimg.onload = function (a) {
			/http[s]*:/.test(this.src) && e(1)
		};
		a = document.getElementsByName("cktxt");
		try {
			var f = localStorage.tcnflg ? parseInt(localStorage.tcnflg) : ptset.bodyobj.tcn
		} catch (l) {
			f = ptset.bodyobj.tcn
		}
		f || (ByID("cktxtp").innerHTML = "\ud83d\udd32");
		for (d = 0; d < a.length; d++)
			a[d].checked = 1 << d & f ? 1 : 0;
		try {
			ptset.setback = localStorage.setback ? parseInt(localStorage.setback) : ptset.setback
		} catch (l) {}

		ByID("loadback").innerHTML = ptset.setback & 1 ? "\u2611\ufe0f" : "\ud83d\udd32";
		ByID("autoback").innerHTML = ptset.setback & 2 ? "\u2611\ufe0f" : "\ud83d\udd32";
		picdiv.style.paddingTop = set.offsetTop + set.offsetHeight + "px";
		canvs.width = parseInt(wid.value) * mmpx;
		canvs.height = parseInt(het.value) * mmpx;
		jsoneditor.style.width = qpspan.offsetLeft + qpspan.offsetWidth + "px";
		jsoneditor.style.left = set.clientLeft + "px";
		jsoneditor.style.height = Hdf - dpi.offsetTop + "px";
		jsoneditor.style.top = dpi.offsetTop + "px";
		d = document.getElementsByTagName("input");
		for (var g in d)
			if (d[g].id && "text" == d[g].type) {
				for (var h = d[g].previousSibling; h && "checkbox" !== h.type; )
					h = h.previousSibling;
				!h || h.id && 0 < ",cmdexe,".indexOf("," + h.id + ",") || (h.checked = d[g].value ? !0 : !1)
			}
		a[12].checked = 4096 & f ? 1 : 0;
		rmerge.checked = 0 == ptset.bodyobj.pagemerge;
		lmerge.checked = 1 == ptset.bodyobj.pagemerge;
		fda.checked = 0 == ptset.bookobj.setmode;
		fdb.checked = 1 == ptset.bookobj.setmode;
		tda.checked = 0 == ptset.bodyobj.setmode;
		tdb.checked = 1 == ptset.bodyobj.setmode;
		mrrorbk.checked = "1" == localStorage.mrrorbk;
		fmpl.value = ptset.bookobj.modeflg;
		startIndex.value = ptset.bodyobj.pageindex;
		mergeval.value = ptset.bodyobj.pagemergeval.join(",");
		nullval.value = ptset.bodyobj.nullpage[3] + "," + ptset.bodyobj.nullpage[4] + "," + ptset.bodyobj.nullpage[2] + "," + ptset.bodyobj.zeropage + "," + ptset.bodyobj.zeroonepage;
		"1" == localStorage.debugzero && (debugzero.innerHTML = "\u2611\ufe0f", autoflg = 1);
		localStorage.debugtxt && "[]" !== localStorage.debugtxt && (debugtxt.innerHTML = "\u2611\ufe0f", f = JSON.parse(localStorage.debugtxt), lput.value = f[0], mput.value = f[1], rput.value = f[2], pyput.value = f[3], coverpytxtflg.value = f[4]);
};
	L();
	var C = 0,
	G = function (a) {
		a /= set.offsetHeight;
		set.style.transformOrigin = "left top";
		set.style.transform = "scaleY(" + a + ")";
		picdiv.style.paddingTop = (set.offsetTop + set.offsetHeight) * a + "px"
	};
	stup.onclick = function (a) {
		C -= 60;
		G(set.offsetHeight + C);
		ptset.setheight = (set.offsetHeight + C) / set.offsetHeight
	};
	stdw.onclick = function (a) {
		C += 60;
		G(set.offsetHeight + C);
		ptset.setheight = (set.offsetHeight + C) / set.offsetHeight
	};
	stuc.onclick = function (a) {
		window.win = window.open(wpyt.value + "?fximg\x3dcrx", "_blank", "top\x3d" + (screen.availHeight - 200) / 2 + ",left\x3d" + (screen.availWidth - 400) / 2 + ",width\x3d400,height\x3d200,directories\x3dno,status\x3dno,location\x3dno,toolbar\x3dno,scrollbars\x3dyes,resizable\x3dno,hotkeys\x3dno");
		setTimeout(function () {
			window.win && window.win.close()
		}, 1E4)
	};
	stureadbtn.onclick = function (a) {
		alertbox(345, 260, "\u6717\u8bfb\u914d\u7f6e:", '\x3cdiv id\x3d"rddiv" style\x3d"color:#00f;font-size:12px;text-align:left;"\x3e\x3cinput id\x3d"spkerck" title\x3d"\u56fd\u8bed\u89d2\u8272\u6bcf\u9875\u987a\u5e8f\u8f6e\u6d41" type\x3d"checkbox"\x3e\u89d2\u8272:\x3cselect id\x3d"spker0" style\x3d"width:70px" title\x3d"\u8bbe\u7f6e\u8bed\u97f3\u540d\u79f0\uff08\u540d\u79f0\u7684\u4e00\u90e8\u5206\u5c31\u8db3\u591f\u4e86\uff09" \x3e\x3coption value\x3d"Microsoft Huihui#-1#0" selected\x3d"selected"\x3eHuihui\x3c/option\x3e\x3coption value\x3d"Microsoft Yaoyao#-1#0"\x3eYaoyao\x3c/option\x3e\x3coption value\x3d"Microsoft Kangkang#-2#0"\x3eKangkang\x3c/option\x3e\x3coption value\x3d"Microsoft Hanhan#-1#0"\x3eHanhan\x3c/option\x3e\x3coption value\x3d"Microsoft Yating#-1#0"\x3eYating\x3c/option\x3e\x3coption value\x3d"Microsoft Zhiwei#0#0"\x3eZhiwei\x3c/option\x3e\x3coption value\x3d"Microsoft Tracy#-1#0"\x3eTracy\x3c/option\x3e\x3coption value\x3d"Microsoft Danny#1#0"\x3eDanny\x3c/option\x3e\x3c/select\x3e\x3cselect id\x3d"spker10" style\x3d"width:70px" \x3e\x3coption value\x3d"-fr 48 -bt 16 -ch 2"\x3e\u53cc\u58f0\u9053\x3c/option\x3e\x3coption value\x3d"-fr 48 -bt 16 -ch 1"\x3e\u5355\u58f0\u9053\x3c/option\x3e\x3coption value\x3d"-fr 16 -bt 16 -ch 1"\x3e\u8bed\u97f3\u58f0\x3c/option\x3e\x3c/select\x3e\u5c01\u9762\u5b57\u4f53:\x3cinput type\x3d"text" id\x3d"spker8" value\x3d"2" size\x3d"2" title\x3d"\u8bbe\u5b9a\u5c01\u9762\u5b57\u56fe\u968f\u673a\u65b9\u5f0f"/\x3e\u9875\u9762\u5b57\u4f53:\x3cinput type\x3d"text" id\x3d"spker9" value\x3d"0" size\x3d"2" title\x3d"\u8bbe\u5b9a\u9875\u9762\u5b57\u56fe\u968f\u673a\u65b9\u5f0f"/\x3e\x3chr/\x3e\u8bed\u901f:\x3cinput type\x3d"text" id\x3d"spker1" value\x3d"0" size\x3d"2" title\x3d"\u5728 -10 \u5230 10 \u7684\u8303\u56f4\u5185\u8bbe\u7f6e\u901f\u5ea6\uff08\u9ed8\u8ba4\u503c\u4e3a 0\uff09"/\x3e\u8bed\u8c03:\x3cinput type\x3d"text" id\x3d"spker2" value\x3d"0" size\x3d"2" title\x3d"\u5c06\u97f3\u9ad8\u8bbe\u7f6e\u4e3a -10 \u5230 10\uff08\u9ed8\u8ba4\u503c\u4e3a 0\uff09\u7684\u8303\u56f4"/\x3e\u97f3\u91cf:\x3cinput type\x3d"text" id\x3d"spker3" value\x3d"100" size\x3d"2" title\x3d"\u5c06\u97f3\u91cf\u8bbe\u7f6e\u4e3a 0 \u5230 100\uff08\u9ed8\u8ba4\u503c\u4e3a 100\uff09"/\x3e\u53e5\u505c\u987f:\x3cinput type\x3d"text" id\x3d"spker4" value\x3d"0" size\x3d"2" title\x3d"\u8bbe\u7f6e\u53e5\u5b50\u4e4b\u95f4\u7684\u505c\u987f\u957f\u5ea6\uff08\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff09\u3002\u9ed8\u8ba4\u503c\u4e3a 0\u3002"/\x3e\u6bb5\u505c\u987f:\x3cinput type\x3d"text" id\x3d"spker5" value\x3d"0" size\x3d"2" title\x3d"\u8bbe\u7f6e\u6bb5\u843d\u4e4b\u95f4\u7684\u505c\u987f\u957f\u5ea6\uff08\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff09\u3002\u9ed8\u8ba4\u503c\u4e3a 0\u3002"/\x3e\x3chr/\x3ecmd:\x3cspan id\x3d"sturead" class\x3d"btnb"\x3e\u751f\u6210\u6709\u58f0\u4e66\u7c4d\x3c/span\x3e\u5f00\u59cb\u9875\u7801:\x3cinput type\x3d"text" id\x3d"spker6" value\x3d"1" size\x3d"2" title\x3d"\u8bf7\u8f93\u5165\u5f00\u59cb\u9875\u7801"/\x3e\u9875\u9762\u5f20\u6570:\x3cinput type\x3d"text" id\x3d"spker7" value\x3d"5" size\x3d"2" title\x3d"\u751f\u6210\u6717\u8bfb\u9875\u6570"/\x3edpi:\x3cinput type\x3d"text" id\x3d"spkerdip" value\x3d"0" size\x3d"2" title\x3d"\u751f\u6210\u56fe\u7247dpi"/\x3e\x3cinput type\x3d"text" id\x3d"spkercmd" value\x3d"" style\x3d"width:336px"/\x3e\x3cbr/\x3e\u6717\u8bfb\u6587\u672c: \x3cselect id\x3d"radst" style\x3d"width:80px"\x3e\x3c/select\x3e\x3cselect id\x3d"radstxt" style\x3d"width:80px"\x3e\x3c/select\x3e\x3caudio id \x3d"audioread" controls style\x3d"width:120px;height:12px;margin-top:3px;"\x3e\x3c/audio\x3e\x3chr/\x3e\x3cspan id\x3d"spkerb1" class\x3d"btnb"\x3e\u6717\u8bfb\u4e0b\u9762\u6587\u672c\x3c/span\x3e\x3cspan id\x3d"spkerb2" class\x3d"btnb"\x3e\u63d0\u53d6\u8f93\u5165\x3c/span\x3e\x3cspan id\x3d"spkerb3" class\x3d"btnb"\x3e\u66ff\u6362\u4e66\u7c4d\u97f3\u9891\x3c/span\x3e\x3cspan id\x3d"spkerb4" class\x3d"btnb"\x3e\u66ff\u6362\u4e66\u7c4d\u56fe\u7247\x3c/span\x3e\x3ctextarea rows\x3d"5" style\x3d"width:338px" id\x3d"spkerput"\x3e\x3c/textarea\x3e\x3c/div\x3e', "read", 1);
		var d = function (a) {
			var d = spker0.value.split("#");
			a && "spker0" == a.id && a.title && (spker1.value = d[1], spker2.value = d[2]);
			spkercmd.value = d[0] + "#" + spker1.value + "#" + spker2.value + "#" + spker3.value + "#" + spker4.value + "#" + spker5.value + "#" + spker10.value + "#";
			stureadbtn.setAttribute("cmd", spkercmd.value);
			try {
				localStorage.lastreadcmd = [spker0.value, spker1.value, spker2.value, spker3.value, spker4.value, spker5.value, spker6.value, spker7.value, spker8.value, spker9.value, spker10.value].join()
			} catch (Q) {}

			click_error()
		};
		read.oninput = read.onchange = function (a) {
			d(a.target)
		};
		a = "";
		try {
			a = localStorage ? localStorage.lastreadcmd ? localStorage.lastreadcmd : "" : ""
		} catch (J) {}

		if (a) {
			a = a.split(",");
			for (var b = 0; 11 > b; b++)
				document.getElementById("spker" + b).value = a[b]
		}
		d({
			id : "spker0"
		})
	};
	stuf.onclick = function (a) {
		window.win = window.open("https://daxuanguji.github.io/book_php_html/html/fem.html?" + wpyt.value, "setbox", "top\x3d" + (screen.availHeight - 500) / 4 + ",left\x3d" + (screen.availWidth - 850) / 2 + ",width\x3d850,height\x3d500,directories\x3dno,status\x3dno,location\x3dno,toolbar\x3dno,scrollbars\x3dyes,resizable\x3dno,hotkeys\x3dno")
	};
	stuh.onclick = function (a) {
		confirm("\u589e\u52a0\u4e66\u540d\u5b57\u7b26\u4f4d??") && (a = prompt("\u8bf7\u8f93\u5165\u4e0a\u79fb\u548c\u4e0b\u79fb\u8ddd\u79bb", "5,30"), /^\d+,\d+$/.test(a) ? (a = eval("[" + a + "]"), ptset.bookobj.loads.box.namebox[0][1] += a[0], ptset.bookobj.loads.box.authorbox[0][1] += a[0], ptset.bookobj.box.cealbox[0][1] += a[0], ptset.bookobj.loads.box.namebox[0][3] += a[1], ptset.bookobj.loads.box.authorbox[0][1] += a[1], ptset.bookobj.box.cealbox[0][1] += a[1]) : alert("\u8f93\u5165\u9519\u8bef!!"))
	};
	var K = function (a) {
		var d = parseInt(wid.value),
		b = function (b, e) {
			b[0][0] = e - b[0][2] / 2;
			/[A-Z]/.test(a) && (b[0][0] += d + parseInt(tbookht.value))
		},
		e = function (a) {
			b(ptset.bookobj.loads.box.namebox, a);
			b(ptset.bookobj.loads.box.authorbox, a);
			b(ptset.bookobj.box.cealbox, a);
			b(ptset.bookobj.loads.box.namebox, a);
			b(ptset.bookobj.loads.box.authorbox, a);
			b(ptset.bookobj.box.cealbox, a)
		};
		/\d+/.test(a) && (a = Number(a), 0 > a && (a = 2 * (d + a) + parseInt(tbookht.value) - a), e(a));
		"L" != a && "l" != a || e(d / 4);
		"M" != a && "m" != a || e(d / 2);
		"R" != a && "r" != a || e(d / 2 + d / 4)
	};
	stuw.onclick = function (a) {
		a = prompt("\u8bf7\u8f93\u5165\u79fb\u52a8\u8ddd\u79bb\nL\u4e3a\u4e2d\u5de6[\u5c0f\u5199\u5de6\u5927\u5199\u53f3]\nM\u4e3a\u4e2d[\u5c0f\u5199\u5de6\u5927\u5199\u53f3]\nR\u4e3a\u4e2d\u53f3[\u5c0f\u5199\u5de6\u5927\u5199\u53f3]\n\u6570\u5b57\u4e3a\u8fb9\u8ddd\u50cf\u7d20[\u6b63\u6570\u5de6\u8d1f\u6570\u53f3]", "m");
		K(a)
	};
	stub.onclick = function (a) {
		a = prompt("\u8bf7\u8f93\u5165\u67e5\u627e\u4e66\u540d!", "\u516c\u5b6b\u9f8d\u5b50");
		var d = screen.availWidth / 2,
		b = screen.availHeight,
		e = parseInt((screen.availHeight - b) / 2 - b),
		f = parseInt(screen.availWidth - d);
		window.open("https://ctext.org/searchbooks.pl?if\x3dgb\x26searchu\x3d" + a, "wjss", "top\x3d" + e + ",left\x3d" + f + ",width\x3d" + d + ",height\x3d" + b + ",directories\x3dno,status\x3dno,location\x3dno,toolbar\x3dno,scrollbars\x3dyes,resizable\x3dno,hotkeys\x3dno")
	};
	stus.onclick = function (a) {
		try {
			localStorage.cxval = lput.value
		} catch (d) {}

		window.win = window.open("https://daxuanguji.github.io/book_php_html/html/fh.html?" + wpyt.value, "setbox", "top\x3d" + (screen.availHeight - 500) / 4 + ",left\x3d" + (screen.availWidth - 850) / 2 + ",width\x3d850,height\x3d500,directories\x3dno,status\x3dno,location\x3dno,toolbar\x3dno,scrollbars\x3dyes,resizable\x3dno,hotkeys\x3dno")
	};
	stuk.onclick = function (a) {
		try {
			localStorage.cxval = lput.value;
			a = "";
			var d = {
				name : ptname.value,
				date : ptauthor.value.split("\x3d")[0],
				author : 1 < ptauthor.value.split("\x3d").length ? ptauthor.value.split("\x3d")[1] : "",
				copyright : ptcopyright.value
			},
			b;
			for (b in d)
				a += "[book_" + b + "]" + d[b] + "\n";
			a += "[config]\n";
			d = {
				qrcode : encodeURIComponent(qrcode.value),
				brcode : brcode.value,
				costxt3 : costxt3.value,
				ptdate : ptdate.value,
				book3d : book3d.value,
				dpi : dpi.value
			};
			for (b in d)
				a += b + "@" + d[b] + "\n";
			a += "[config]\n";
			localStorage.cxval = otxt ? a + otxt : a + lput.value
		} catch (J) {}

		window.win = window.open("https://daxuanguji.github.io/book_php_html/html/book/book.html?" + wpyt.value, "setbox", "top\x3d0,left\x3d300,width\x3d" + (screen.availWidth - 300) + ",height\x3d" + screen.availHeight + ",directories\x3dno,status\x3dno,location\x3dno,toolbar\x3dno,scrollbars\x3dyes,resizable\x3dno,hotkeys\x3dno")
	};
	G(ptset.setheight * set.offsetHeight);
	setex.onclick = function (a) {
		"none" == jsoneditor.style.display ? (jsoneditor.style.display = "block", editor.set(ptset)) : (ptobj = ptset = editor.get(), repsetex(), jsoneditor.style.display = "none")
	};
	set.onclick = function (a) {
		if(a.altKey){
			var html='<span style="display:inline-block;width:60px" id="ssid" class="btnb">查找id:</span><input type="text" value="'+a.target.id+'" size="36" title="输入后此框左上角与查找到的对齐"/><br>';html+='<span style="display:inline-block;width:60px" >id:</span><input type="text" value="'+a.target.id+'" size="36" title="双击复制"/><br>';html+='<span style="display:inline-block;width:60px" >value:</span><input type="text" value="'+a.target.value+'" size="36" title="双击复制"/><br>';html+='<span style="display:inline-block;width:60px" >checked:</span><input type="text" value="'+a.target.checked+'" size="36" title="双击复制"/><br>';if(a.target.type == "checkbox"||a.target.type == "radio") html+='<span style="display:inline-block;width:60px" >config:</span><input type="text" value="'+a.target.id+"@"+a.target.checked+'" size="36" title="双击复制"/><br>';else html+='<span style="display:inline-block;width:60px" >config:</span><input type="text" value="'+a.target.id+"@"+a.target.value+'" size="36" title="双击复制"/><br>';html+='<span style="display:inline-block;width:60px" >des:</span><textarea rows="5" style="width:338px">'+help[a.target.id]+'</textarea>';
			alertbox(345,260,"config配置:",html,"copy",1);
			ByID("ssid").onclick = function(e){
				var c=this.nextElementSibling.value;
				if(!c)return;c=ByID(c);
				if(!c)return;
				var m=c.getBoundingClientRect();
				ByID("copy").style.top=(m.top+window.screenX+c.offsetHeight)+"px";
				ByID("copy").style.left=(m.left+window.screenY)+"px"
			}
			ByID("copy").ondblclick = function(e){
				if(e.target.tagName=="INPUT"&&e.target.title=="双击复制"){
					e.target.select();document.execCommand("Copy");
					alert("内容已经复制到剪切板")
				}
			}
			return;
		}
		O(a.target)
	};
	coverpytxtflg.onclick = function (a) {
		this.value = "\u2611\ufe0f" == this.value ? "\ud83d\udd32" : "\u2611\ufe0f"
	};
	coverpytxt.onclick = function (a) {
		pyput.value = pyput.value.replace(/[\r]*\n/g, "$");
		pyput.value = pyput.value.replace(/^[,\s]|[,\s]$/g, "");
		a = pyput.value.match(/[a-zA-Z\u0101\u00e1\u01ce\u00e0\u014d\u00f3\u01d2\u00f2\u0113\u00e9\u011b\u00e8\u012b\u00ed\u01d0\u00ec\u016b\u00fa\u01d4\u00f9\u00fc\u01d6\u01d8\u01da\u01dc\u0144\u0148\u01f9\u1e3fm\u0261]+/g);
		var d = pyput.value.match(/[\ud840-\ud888]*[\u3400-\uFAD9\$]/g);
		if (a)
			if (d) {
				a = a.join(",");
				var d = d.join(""),
				b = a.replace(/^[,\s]|[,\s]$/g, "").split(",").length,
				e = d.length,
				f = d.match(/\$/g) ? d.match(/\$/g).length : 0;
				b !== e - f && alert("\u62fc\u97f3\u6587\u672c\u6570\u91cf\u4e0d\u5bf9\u7b49\na\x3d" + b + "\nb\x3d" + (e - f));
				pyput.value = a;
				upchang(pyput);
				confirm("\u540c\u6b65\u6587\u672c\u5230\u8f93\u5165\u6846???") && (lput.value = d, upchang(lput))
			} else
				alert("\u6c49\u5b57\u4e3a\u7a7a");
		else
			alert("\u62fc\u97f3\u4e3a\u7a7a")
	};
	pyput.onchange = function (a) {
		ptset.bodyobj.pytxt = this.value
	};
	zeroOne.onchange = function (a) {
		a = this.value;
		"0" == a[0] ? ("+" == a[1] && (ptset.bodyobj.nullpage[3] = 1), "-" == a[1] && (ptset.bodyobj.nullpage[3] = 2), "*" == a[1] && (ptset.bodyobj.nullpage[3] = 3), "\x3d" == a[1] && (ptset.bodyobj.nullpage[2] = 0)) : (a = Number(this.value), 255 < a ? ptset.bodyobj.zeropage = a - 256 : (a || (ptset.bodyobj.flag.bk && (a += 1), ptset.bodyobj.flag.Tbk && (a += 2), ptset.bodyobj.flag.cel && (a += 4), ptset.bodyobj.flag.txtbk && (a += 8), ptset.bodyobj.flag.txtbox && (a += 16), ptset.bodyobj.flag.picbox && (a += 32), ptset.bodyobj.flag.pageidx && (a += 64), ptset.bodyobj.flag.pagewat && (a += 128)), ptset.bodyobj.nullpage[2] = a))
	};
	set.onchange = set.onkeyup = function (a) {
		a = a.target;
		if ("usize" == a.id && "/" !== txtpath.value.slice(-1))
			mput.value = lput.value = "", uptxtfile(txtpath.value, 0, usize.value);
		else if ("startIndex" == a.id)
			ptset.bodyobj.pageindex = parseInt(a.value), repsetex();
		else if ("thisfpage" == a.id)
			pidx = parseInt(a.value), pagepdf[0] = pidx - 1;
		else if ("thisrpage" == a.id)
			pagepdf[0] = pidx = parseInt(a.value);
		else if ("bookIndex" != a.id && "pyput" != a.id && "rput" != a.id && "lput" != a.id && "mput" != a.id && "gotopng" != a.id && "gotopngtimer" != a.id)
			if ("mergeval" == a.id)
				 / ^ \ d + ,  \ d + ,  \ d$ / .test(a.value) ? ptset.bodyobj.pagemergeval = eval("[" + a.value + "]") : errtxt.innerHTML = "\u8f93\u5165\u683c\u5f0f\u9519\u8befd+,d+,d";
			else if ("nullval" == a.id)
				if (/^\d,\d,\d+,\d,\d$/.test(a.value)) {
					var d = eval("[" + a.value + "]");
					ptset.bodyobj.nullpage[3] = d[0];
					ptset.bodyobj.nullpage[4] = d[1];
					ptset.bodyobj.nullpage[2] = d[2];
					ptset.bodyobj.zeropage = d[3];
					ptset.bodyobj.zeroonepage = d[4]
				} else
					errtxt.innerHTML = "\u8f93\u5165\u683c\u5f0f\u9519\u8befd,d,d+,d,d";
			else if ("cktxt" == a.name)
				y();
			else if ("kaisu" == a.id)
				ptset.bodyobj.pagespt[0] = parseInt(a.value);
			else if ("checkbox" == a.type)
				if (a.id && 0 < "\x3d,rptname,rptauthor,rptcopyright,rptdate,rptcel,rptpage,rptbk,rptag,rptbkT,rptwat,rptpgidx,rpttxt,rptptxt,autopage,cmdexe,autopng,rpttbk,qpimg,mrrorbk,".indexOf("," + a.id + ","))
					n(a);
				else {
					for (d = a.nextSibling; d && !d.type && "INPUT" !== d.type; )
						d = d.nextSibling;
					"BUTTON" != d.type && (a.checked ? f[d.id] && (d.value = d.id && 0 < "\x3d,backpic,bookpic,bodypic,bodybk,bodycel,txtcel,txtfc,txtbc,txtpfc,txtpbc,cosimg1,cosimg2,".indexOf("," + d.id + ",") ? "#" + f[d.id] : f[d.id]) : (f[d.id] = "#" == d.value[0] ? recolor(d.value) : d.value, d.value = ""), A(d), d.id && 0 > "\x3d,backpic,bookpic,bodypic,bodybk,bodycel,txtcel,txtfc,txtbc,txtpfc,txtpbc,cosimg1,cosimg2,".indexOf("," + d.id + ",") && upchang(d))
				}
			else {
				A(a);
				for (d = a.previousSibling; d && "checkbox" !== d.type; )
					d = d.previousSibling;
				d && (d.checked = a.value ? !0 : !1)
			}
	};
	var H = function (a) {
		var d = oldpath + ptset.bodypath + ptset.bodyobj.path[a] + ptset.bodyobj.subpath[a];
		ptset.bodyobj.path[a] || (d = oldpath + ptset.fontpath);
		window.setimgwind = window.open("https://daxuanguji.github.io/book_php_html/html/img.html?" + wpyt.value + "?" + d, "setimgwind", "top\x3d100,left\x3d0,width\x3d350,height\x3d" + (screen.availHeight - 100) + ",directories\x3dno,status\x3dno,location\x3dno,toolbar\x3dno,scrollbars\x3dyes,resizable\x3dno,hotkeys\x3dno")
	};
	tbodyimg.ondblclick = function (a) {
		H(2)
	};
	tbodytxt.ondblclick = function (a) {
		H(0)
	};
	tbodyret.ondblclick = function (a) {
		H(1)
	};
	set.ondblclick = function (a) {
		0 < "\x3d,tbookpic,tbackpic,tbodypic,tbodybk,tbodycel,ttxtcel,ptceal,ptwat,cosimg1,cosimg2,".indexOf("," + a.target.id + ",") &&(g(openfile, a.target),alert("网络版不支持上传图片;可到风格预览里选择已存在的图片设置背景"))
	};
	ptceal.value = ptset.bookobj.box.cealbox[2][1];
	upchang(ptceal);
	openfile.onchange = function (a) {
		pagefiles = null;
		var d = this.files[0];
		d && (a = d.type, /json/.test(a) && "loadpage" == MCKID.id ? 1 < this.files.length ? (pagefiles = [this.files, 0], listpage.innerHTML = "\u2611\ufe0f", lput.value = ptset.bodyobj.nullpage[1], autoflg = 1, a = document.createEvent("MouseEvents"), a.initEvent("click", !1, !0), ptbook.dispatchEvent(a)) : (listpage.innerHTML = "\ud83d\udd32", a = new FileReader, a.readAsText(d), a.onload = function (a) {
				exppagein(a.target.result, (new Date).getTime())
			}) : /json/.test(a) && "loadobj" == MCKID.id ? (a = new FileReader, a.readAsText(d), a.onload = function (a) {
				try {
					var d = JSON.parse(a.target.result);
					d.infopath && d.bookobj.loads.box.namebox && d.bodyobj.bk.tbj ? (ptset = d, u(), L()) : (alert("\u6570\u636e\u975e\u672c\u7a0b\u5e8f\u521b\u5efa\u65e0\u6cd5\u8bfb\u53d6"), errtxt.innerHTML = "\u6570\u636e\u975e\u672c\u7a0b\u5e8f\u521b\u5efa\u65e0\u6cd5\u8bfb\u53d6")
				} catch (z) {
					errtxt.innerHTML = "\u6570\u636e\u8f6c\u6362\u6709\u9519\u8bef:" + z
				}
			}) : /text/.test(a) && "loadtxt" == MCKID.id ? (a = new FileReader, a.readAsText(d), a.onload = function (a) {
				utindex = 0;
				a = a.target.result;
				/\[(\d+,){4}/.test(a) && "]" == a[a.length - 1] ? (predoc = JSON.parse(a), conftxt("[config]" + predoc[predoc.length - 1][1] + "[config]"), predoc[predoc.length - 1][2] && (mput.value = predoc[predoc.length - 1][2]), predoc[predoc.length - 1][3] && (rput.value = predoc[predoc.length - 1][3]), fxtxtbox = predoc[predoc.length - 1][4], MCk(rebody)) : (bfg = afg = 1, imgid = lastflg = tflg = thy = tlh = tdh = 0, repsetex(), a = repimg(a), otxt = lput.value = a[0], a[1] && (mput.value = ":;0:" + a[1]), a = conftxt(lput.value), lput.value = a, txtpath.value = d.name)
			}) : /text/.test(a) && "loadurltxt" == MCKID.id ? (txtpath.value = bookspath + d.name, bfg = afg = 1, imgid = lastflg = tflg = thy = tlh = tdh = 0, thisfpage.value ? (pidx = parseInt(thisfpage.value), pagepdf[0] = pidx - 1) : pagepdf[0] = pidx = parseInt(thisrpage.value), mput.value = lput.value = "", utindex = 0, utfilesize = d.size, uptxtfile(txtpath.value, utindex, usize.value)) : (/image/.test(a) && geturl("filespath=./images/back/mini/", function (a) {
					a = a.split(",");
					var b = 0,
					e;
					for (e in a)
						a[e] == d.name && b++;
					if (!b) {
						var f = prompt("back\u76ee\u5f55\u4e0b[" + d.name + "]\u4e0d\u5b58\u5728\n\u662f\u5426\u590d\u5236\uff1f\uff1f\n\u8f93\u5165\u590d\u5236\u540e\u6587\u4ef6\u540d", d.name);
						/.\.[a-z]{2,4}/.test(f) && (e = new FileReader, e.readAsDataURL(d), e.onload = function (a) {
							upfile("?" + f, a.target.result.split(",")[1], 0);
							MCKID.value = f;
							upchang(MCKID)
						})
					}
				}), MCKID.value = d.name, upchang(MCKID)))
	};
	jscolor.presets["default"] = {
		palette : "#010101 #7d7d7d #870014 #ec1c23 #ff7e26 #fef100 #22b14b #00a1e7 #3f47cc #a349a4 #fefefe #c3c3c3 #b87957 #feaec9 #ffc80d #eee3af #b5e61d #99d9ea #7092be #c8bfe7".split(" ")
	};
	savepdf.onclick = function (a) {
		a = document.createEvent("MouseEvents");
		a.initEvent("click", !1, !0);
		rebody.dispatchEvent(a);
		setTimeout(function () {
			var a = canvs.width / .75,
			b = canvs.height / .75,
			e = new jsPDF(a > b ? "l" : "p", "pt", [a, b], !1);
			e.addImage(toCvDataURL(canvs), itpe[3], 0, 0, a, b, null, "none");
			e.save(ptname.value + fliespt + pagepdf[0] + ".pdf")
		}, 500)
	};
	savepng.onclick = function (a) {
		var d = lastflg && 1 < pagepdf[0] ? pagepdf[0] - 1 : pagepdf[0];
		setTimeout(function () {
			var a = ptname.value + fliespt + d + "." + itpe[0];
			canvs.toBlob(function (d) {
				taobao.length ? down(taobao.shift(), d) : down(a, d)
			}, itpe[2], itpe[1])
		}, 500)
	};
	savetb.onclick = function (a) {
		if ("\ud83d\udd32\u6279\u91cf" == autotb.value) {
			a = prompt("\u8bf7\u8f93\u5165\u968f\u673a\u5c01\u9762\u6a21\u7248id\n\u8303\u56f4[0-" + (Object.keys(booksetlist).length - 1) + "] autoset.js\u67e5\u770b\u914d\u7f6e!", 1);
			if (!a) {
				alert("\u672a\u8f93\u5165");
				return
			}
			taobao_fg(parseInt(a))
		}
		taobao_stat();
		taobao = taobao_fm;
		tbodyrand.value = "2";
		upchang(tbodyrand);
		book3dk.innerHTML = "\ud83d\udd32";
		"undefined" === typeof ptset.bookobj.box.taobaofm && (ptset.bookobj.box.taobaofm = [[-10, "H-d[3]", 40, 40], "", ["s", "ceal31.png"]], ptset.bookobj.box.taobaofmt = [["X-1.5+fex/2", -50, "X", 30], "", ["s", "taobaofmt.png"]]);
		MCk(ptbook)
	};
	savett.onclick = function (a) {
		taobao_stat();
		taobao = taobao_ym;
		upchang(tbodyrand);
		book3dk.innerHTML = "\ud83d\udd32";
		MCk(ptbody)
	};
	oneotb.onclick = function (a) {
		click_error();
	};
	dpiotb.onclick = function (a) {
		click_error();
	};
	autotb.onclick = function (a) {
		autotb.value = "\u2611\ufe0f\u6279\u91cf" == autotb.value ? "\ud83d\udd32\u6279\u91cf" : "\u2611\ufe0f\u6279\u91cf";
		if ("\u2611\ufe0f\u6279\u91cf" == autotb.value) {
			var d = prompt("\u8bf7\u8f93\u5165\u6587\u672c\u76ee\u5f55!", taobao_mu);
			d ? (d = d.split("\\"), d = d.join("/") + "/", tbfilelist = [], tbfilelist.push(d), geturl("filespath\x3d" + d, function (a) {
					if ((a = a.split(",")) && a.length) {
						for (var b = 0; b < a.length; b++)
							a[b] && "txt" === a[b].slice(-3) && tbfilelist.push(d + a[b]);
						lput.value = "";
						ptset.bookobj.bk3d = "6,6,#ffffffff,1,10";
						"undefined" === typeof ptset.bookobj.box.taobaofm && (ptset.bookobj.box.taobaofm = [[-10, "H-d[3]", 40, 40], "", ["s", "ceal31.png"]], ptset.bookobj.box.taobaofmt = [["X+fex/2", -50, "X", 30], "", ["s", "taobaofmt.png"]]);
						taobao_fg();
						uptxtfile(tbfilelist.pop(), 0, 15E3);
						debugzero.innerHTML = "\ud83d\udd32";
						autoflg = 0;
						try {
							localStorage.debugzero = autoflg
						} catch (z) {}

						pagepdf = [0, 0, 0, null, 0];
						MCk(savett)
					}
				})) : alert("\u672a\u8f93\u5165")
		}
	};
	var M = function (a) {
		if (ByID("kimg"))
			document.body.removeChild(ByID("kimg"));
		else {

			var d = document.createElement("div");
			d.style.position = "absolute";
			d.style.zIndex = 10210;
			d.id = "kimg";
			d.style.height = "100%";
			var b = document.documentElement.scrollLeft || document.body.scrollLeft;
			d.style.top = Math.max(document.documentElement.scrollTop || document.body.scrollTop, kanpng.offsetHeight) + "px";
			d.style.left = parseInt(jsoneditor.style.width.replace("px", "")) + b + "px";
			d.style.textAlign = "center";
			var b = document.createElement("canvas"),
			e = b.getContext("2d");
			b.height = Hdf - kanpng.offsetHeight;
			b.width = b.height / a.height * a.width;
			e.drawImage(a, 0, 0, b.width, b.height);
			d.appendChild(b);
			document.body.appendChild(d)
		}
	};
	kanpng.onclick = function (a) {
		M(canvs)
	};
	var I = function (a) {
		27 == a && (ByID("kimg") ? document.body.removeChild(ByID("kimg")) : (a = FULL = Wdf / canvs.offsetWidth, picdiv.style.transformOrigin = "left top", picdiv.style.paddingTop == set.offsetTop + set.offsetHeight + "px" ? (picdiv.style.transform = "scale(" + a + ")", picdiv.style.paddingTop = "0px", qpimg.checked = !0) : (picdiv.style.transform = "none", picdiv.style.paddingTop = set.offsetTop + set.offsetHeight + "px", qpimg.checked = !1)))
	};
	qpimg.onchange = function (a) {
		I(27)
	};
	document.ondblclick = function (a) {
		qpimg.checked && I(27)
	};
	fontfm.onchange = function (a) {
		ptset.bookobj.font.name[0] = ptset.bookobj.font.name[0].replace(/px\s.+/, "px " + this.value);
		ptset.bookobj.font.author[0] = ptset.bookobj.font.author[0].replace(/px\s.+/, "px " + this.value);
		ptset.bookobj.font.copyright[0] = ptset.bookobj.font.copyright[0].replace(/px\s.+/, "px " + this.value);
		ptset.bookobj.font.htxt[0] = ptset.bookobj.font.htxt[0].replace(/px\s.+/, "px " + this.value);
		ptset.bookobj.font.midname[0] = ptset.bookobj.font.midname[0].replace(/px\s.+/, "px " + this.value)
	};
	fontwm.onchange = function (a) {
		ptset.bodyobj.wfont[0] = ptset.bodyobj.wfont[0].replace(/px\s.+/, "px " + this.value)
	};
	document.onkeydown = function (a) {
		a.target.onblur = 229 == a.keyCode ? function (d) {
			A(a.target)
		}
		 : null;
		27 == a.keyCode && I(a.keyCode)
	};
	pytexe.onclick = function (a) {
		click_error();
		sendExeStatu();
		cmdexe.checked = !1
	};
	wpyt.onclick = function (a) {
		if (a = prompt("\u8bf7\u8f93web\u8def\u5f84", wpyt.value))
			wpyt.value = a
	};
	stut.onclick = function (a) {
		if (a = prompt("\u8bf7\u8f93\u5b89\u88c5\u5b57\u4f53\u540d\u548c\u989c\u8272\nkaiT\nsongT\nmingT\nWsongT\n\u5b57\u4f53\u6587\u4ef6\u5e94\u662f\u653e\u7f6e\\bat\\FONT\u4e0b\u7684TTF\u6587\u4ef6", "kaiT#000000"))
			a = a.split(".")[0], confirm("\u786e\u8ba4\u5b89\u88c5\u9ed8\u8ba4\u5b57\u4f53\u56fe\u7247\u5230\nimages\\font\\" + a + "\u4e0b\n\u53ef\u80fd\u8017\u65f6\u51e0\u5206\u949f???") && click_error()
	};
	stud.onclick = function (a) {
		(a = prompt("\u8bf7\u8f93\u5220\u9664\u5b57\u4f53\u540d\n\u5b57\u4f53\u540d\u5e94\u662fimages\\font\\\u4e0b\u76ee\u5f55", "kaiT")) && confirm("\u786e\u8ba4\u5220\u9664\u9ed8\u8ba4\u5b57\u4f53\u56fe\u7247\u6587\u4ef6\u5939\nimages\\font\\" + a + "\u4e0b\n\u6240\u6709\u56fe\u7247???") && click_error()
	};
	stupk.onclick = function (a) {
		if (a = prompt("\u8bf7\u8f93\u6253\u5305\u5b57\u4f53\u540d\nkaiT\nsongT\nmingT\nWsongT\n\u5b57\u4f53\u540d\u5e94\u662fimages\\font\\\u4e0b\u76ee\u5f55", "kaiT"))
			a = a.split(".")[0], confirm("\u786e\u8ba4\u6253\u5305\u5b57\u4f53\u56fe\u7247\u5230\nimages\\font\\" + a + ".dt\u6570\u636e\u6587\u4ef6\nimages\\font\\" + a + ".dtx\u7d22\u5f15\u6587\u4ef6\n\u53ef\u80fd\u8017\u65f6\u51e0\u5206\u949f???") && click_error()
	};
	stuupk.onclick = function (a) {
		if (a = prompt("\u8bf7\u8f93\u89e3\u5305\u5b57\u4f53\u540d\nkaiT\nsongT\nmingT\nWsongT\n\u5b57\u4f53\u540d\u5e94\u662fimages\\font\\\u4e0b\u6253\u5305\u751f\u6210\u7684dt\u6587\u4ef6\u548cdtx\u6587\u4ef6\u540d", "kaiT"))
			a = a.split(".")[0], confirm("\u786e\u8ba4\u89e3\u5305\u5305\u5b57\u4f53\nimages\\font\\" + a + ".dtx\n\u5230\nimages\\font\\" + a + "_unpack\n\u76ee\u5f55\u4e0b\n\u53ef\u80fd\u8017\u65f6\u51e0\u5206\u949f???") && click_error()
	};
	var N = function (a) {
		for (var d = ptset.bookobj.bk3d.split(","), b = ptobj.bookobj.height[0] * mmpx, e = parseInt(d[0]) ? parseInt(d[0]) : b, f = parseInt(d[1]), g = d[2], g = g.replace("#", ""), h = parseInt(d[3]), d = parseInt(d[4]), g = g.match(/[a-fA-F0-9]{2}/g), l = 0; l < g.length; l++)
			g[l] = parseInt(g[l], 16);
		var n = document.createElement("canvas"),
		r = n.getContext("2d"),
		p = canvs.height,
		x = canvs.width / 2 - ptobj.bookobj.height[0] * mmpx / 2,
		u = canvs.width / 2 + ptobj.bookobj.height[0] * mmpx / 2;
		n.width = x + e + 2 * d;
		n.height = p + f + 2 * d;
		r.fillStyle = "rgba(255,255,255,255)";
		r.fillRect(0, 0, n.width, n.height);
		r.clearRect(0, 0, n.width, n.height);
		if (a) {
			var m = k.getImageData(0, 0, x, p);
			r.putImageData(m, d, d)
		} else
			m = k.getImageData(u, 0, x, p), r.putImageData(m, d + e, d);
		for (var q = 0; q < e; q++)
			if (m = q / e * b, a) {
				var y = d + x + q,
				t = d + q * f / e,
				m = k.getImageData(x + m, 0, 1, p);
				r.putImageData(m, y, t)
			} else
				y = d + x + q + e, t = d - q * f / e, m = k.getImageData(x + m, 0, 1, p - 1), r.putImageData(m, y - x - e, t + f);
		for (q = 0; q < f - 1; q++) {
			if (a) {
				y = d + q * e / f;
				t = d + p + q;
				if (q < f - h - 1)
					m = k.getImageData(0, p - q - 1, x, 1);
				else {
					m = k.getImageData(u, p - (f - q) - 1, x, 1);
					b = [];
					for (l = m.data.length - 4; 0 <= l; l -= 4)
						b.push(m.data[l]), b.push(m.data[l + 1]), b.push(m.data[l + 2]), b.push(m.data[l + 3]);
					for (l = 0; l < b.length; l++)
						m.data[l] = b[l]
				}
				r.putImageData(m, y + 2, t)
			} else {
				y = d + e - q * e / f;
				t = d + p + q;
				if (q < f - h - 1)
					m = k.getImageData(u, p - q - 1, x, 1);
				else {
					m = k.getImageData(0, p - (f - q) - 1, x, 1);
					b = [];
					for (l = m.data.length - 4; 0 <= l; l -= 4)
						b.push(m.data[l]), b.push(m.data[l + 1]), b.push(m.data[l + 2]), b.push(m.data[l + 3]);
					for (l = 0; l < b.length; l++)
						m.data[l] = b[l]
				}
				r.putImageData(m, y - 1, t)
			}
			if (q > h && q < f - h - 1)
				if (a)
					for (l = 0; l < m.data.length; l += 4)
						l / 4 % x < x - h && (m.data[l] = g[0], m.data[l + 1] = g[1], m.data[l + 2] = g[2], m.data[l + 3] = g[3]);
				else
					for (l = 0; l < m.data.length; l += 4)
						l / 4 % x > h && (m.data[l] = g[0], m.data[l + 1] = g[1], m.data[l + 2] = g[2], m.data[l + 3] = g[3]);
			r.putImageData(m, y, t)
		}
		if ("\u2611\ufe0f\u6279\u91cf" == autotb.value) {
			var e = toCvDataURL(n).split(",")[1],
			B = taobao.shift();
			upfile(B, e, 0, function (a) {
				/\u5df2\u4fdd\u5b58/.test(a) && geturl("fmu\x3d" + tbfilelist[0] + "/" + ptname.value + "/\x26fximg\x3dpng-resize\x26filespath\x3d" + B + "\x26t\x3d" + (new Date).getTime(), function (a) {})
			});
			!a && 0 < tbfilelist.length && (1 == tbfilelist.length ? autotb.value = "\ud83d\udd32\u6279\u91cf" : (taobao_fg(), setTimeout(function () {
							txtpath.value = tbfilelist.pop();
							bookIndex.value = mput.value = lput.value = rput.value = pyput.value = "";
							coverpytxtflg.value = "\ud83d\udd32";
							bfg = afg = 1;
							imgid = lastflg = tflg = thy = tlh = tdh = 0;
							thisfpage.value ? (pidx = parseInt(thisfpage.value), pagepdf[0] = pidx - 1) : pagepdf[0] = pidx = parseInt(thisrpage.value);
							utindex = 0;
							uptxtfile(txtpath.value, 0, 15E3);
							pagepdf = [0, 0, 0, null, 0];
							MCk(savett)
						}, 3E3)))
		} else
			"\u2611\ufe0f" == book3dk.innerHTML && M(n)
	};
	studf.onclick = function (a) {
		N(!0)
	};
	studr.onclick = function (a) {
		N(!1)
	};
	cmdexe.onchange = function (a) {
		click_error()
	};
	nextpg.onclick = function (a) {
		a = parseInt(thisfpage.value);
		var b = parseInt(thisrpage.value);
		a % 2 || thisrpage.value ? a - 1 == b ? (thisrpage.value = "", upchang(thisrpage), thisfpage.value = a + 1, upchang(thisfpage)) : (0 > b && (thisrpage.value = b = 0), thisfpage.value ? (thisfpage.value = "", upchang(thisrpage)) : (thisrpage.value = b + 2, thisfpage.value = thisrpage.value, upchang(thisfpage))) : (thisfpage.value = a + 1, upchang(thisfpage), thisrpage.value = a, upchang(thisrpage))
	};
	povpg.onclick = function (a) {
		if ("1" == thisrpage.value && "" == thisfpage)
			confirm("\u8f93\u51fa0-null\u9875\u9762\u786e\u8ba4???") && (thisrpage.value = "0", upchang(thisrpage));
		else {
			a = parseInt(thisfpage.value);
			var b = parseInt(thisrpage.value);
			2 > a || (a % 2 || thisrpage.value ? a - 1 == b ? (thisrpage.value = "", upchang(thisrpage), thisfpage.value = a - 1, upchang(thisfpage)) : 2 > b || (thisfpage.value ? (thisfpage.value = "", thisrpage.value = b - 2, upchang(thisrpage)) : (thisfpage.value = thisrpage.value, upchang(thisfpage))) : (thisrpage.value = a - 2, upchang(thisrpage), thisfpage.value = a - 1, upchang(thisfpage)))
		}
	}
};
var getLocation = function (b) {
	if (b.createTextRange) {
		var e = document.selection.createRange();
		e.setEndPoint("StartToStart", b.createTextRange());
		return e.text.length
	}
	if ("number" == typeof b.selectionStart)
		return b.selectionStart
}, geteLocation = function (b) {
	if (b.createTextRange) {
		var e = document.selection.createRange();
		e.setEndPoint("EndToEnd", b.createTextRange());
		return e.text.length
	}
	if ("number" == typeof b.selectionEnd)
		return b.selectionEnd
}, setLocation = function (b, e, f) {
	f > b.value.length && (f = b.value.length);
	b.createTextRange ? (b = b.createTextRange(), b.moveStart("character", e), b.moveEnd("character", f), b.collapse(), b.select()) : b.setSelectionRange && (b.setSelectionRange(e, f), b.focus())
}, messbox = [];
function message(b, e, f, k, g, h) {
	k || (k = "#00f");
	h || (h = [300, 200]);
	e = e.replace(/[\r]*[\n]+/g, "\x3cbr/\x3e");
	b = '\x3cdiv class\x3d"title"\x3e' + b + '\x3c/div\x3e\x3cspan class\x3d"msgclose"\x3eX\x3c/span\x3e\x3cdiv  class\x3d"con" style\x3d"color:' + k + ';"\x3e' + e + "\x3c/div\x3e";
	e = document.createElement("div");
	e.style.width = h[0] + "px";
	e.style.height = h[1] + "px";
	e.className = "winpop";
	e.style.right = 0;
	e.style.bottom = 0;
	g & 1 && (e.style.left = 0);
	g & 2 && (e.style.top = 0);
	e.innerHTML = b;
	messbox.push(e);
	document.body.appendChild(e);
	for (b = 0; b < messbox.length; b++)
		e = messbox.length - 1 - b, 0 < e && (g & 2 ? messbox[b].style.top = e * h[1] + "px" : messbox[b].style.bottom = e * h[1] + "px");
	document.querySelector(".msgclose").onclick = function () {
		this.parentNode.style.visibility = "hidden"
	};
	f && setTimeout(function () {
		document.body.removeChild(messbox.shift())
	}, 1E3 * f)
}
function progress(b, e, f, k) {
	var g = ByID("prc");
	k && (g.style.height = 30 * k + "px");
	ByID("pro") || (g.innerHTML = '\x3cdiv id\x3d"prt" class\x3d"progtxt"\x3e\x3c/div\x3e\x3cprogress id\x3d"pro" class\x3d"progress" value\x3d"0" max\x3d"100"\x3e\x3c/progress\x3e');
	var h = ByID("pro"),
	p = ByID("prt");
	b = Math.min(b, 100);
	p.innerHTML = e;
	h.value = parseInt(b);
	f = f ? 1E3 * f : 1;
	100 == b && f ? setTimeout(function () {
		g.style.visibility = "hidden";
		k && (g.style.height = "30px")
	}, f) : g.style.visibility = "visible"
}
function Base64UrlToBlob(b) {
	if (!/base64,/.test(b))
		return b;
	var e = b.split(",");
	b = e[0].match(/:(.*?);/)[1];
	for (var e = window.atob(e[1]), f = new ArrayBuffer(e.length), k = new Uint8Array(f), g = 0; g < e.length; g++)
		k[g] = e.charCodeAt(g);
	return new Blob([f], {
		type : b
	})
}
function down(b, e) {
	var f = window.URL || window.webkitURL || window,
	k = new Blob([e]);
	if (window.navigator.msSaveBlob)
		window.navigator.msSaveBlob(k, b);
	else {
		var g = document.createElementNS("http://www.w3.org/1999/xhtml", "a");
		g.href = f.createObjectURL(k);
		g.download = b;
		f = document.createEvent("MouseEvents");
		f.initMouseEvent("click", !0, !1, window, 0, 0, 0, 0, 0, !1, !1, !1, !1, 0, null);
		g.dispatchEvent(f)
	}
}
function alertbox(b, e, f, k, g, h, p) {
	ByID(g) && document.body.removeChild(ByID(g));
	var u = (screen.availHeight - e) / 3,
	A = (tbe.offsetWidth - b) / 2,
	n = document.createElement("div");
	n.style.height = e + "px";
	n.style.width = b + "px";
	n.style.overflowY = "auto";
	n.style.top = u + "px";
	n.style.left = A + "px";
	n.style.padding = "0px";
	n.style.color = "#00f";
	n.style.backgroundColor = "#0ff";
	n.style.position = "absolute";
	n.style.zIndex = 112;
	n.style.boxShadow = "0 0 #74a3b0";
	n.style.backgroundColor = p ? p : "#ff0";
	n.style.border = "4px solid black";
	n.style.borderRadius = "10px";
	n.innerHTML = '\x3cdiv id\x3d"mvp" style\x3d"width:' + b + 'px;cursor:default;background-color:#CCC"\x3e' + f + '\x3cstrong id\x3d"' + g + 'close" style\x3d"background-color:#FF0;cursor:default;float: right;z-index:1000"\x3e\u274e\x3c/strong\x3e\x3c/div\x3e\x3chr/\x3e' + k;
	n.id = g;
	document.body.appendChild(n);
	ByID(g + "close").onclick = function () {
		document.body.removeChild(ByID(g))
	};
	if (h) {
		var t = !1;
		mvp.onmousedown = function (b) {
			b.target.id == g + "close" && document.body.removeChild(ByID(g));
			t = !0
		};
		mvp.onmouseup = mvp.onmouseout = function (b) {
			t = !1;
			b.stopPropagation()
		};
		mvp.onmousemove = function (b) {
			b.stopPropagation();
			t && (n.style.top = b.clientY - 10 + "px", n.style.left = b.clientX - 150 + "px")
		}
	}
}
function getDPI() {
	var b = [];
	if (void 0 != window.screen.deviceXDPI)
		b[0] = window.screen.deviceXDPI, b[1] = window.screen.deviceYDPI;
	else {
		var e = document.createElement("DIV");
		e.style.cssText = "width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden";
		document.body.appendChild(e);
		b[0] = parseInt(e.offsetWidth);
		b[1] = parseInt(e.offsetHeight);
		e.parentNode.removeChild(e)
	}
	return b
}
String.prototype.splice = function (b, e) {
	return this.slice(0, b) + e + this.slice(b)
};
String.prototype.del = function (b, e) {
	return this.slice(0, b) + this.slice(b + e)
};
String.prototype.gtxt = function (b) {
	return /[\ud840-\ud888]/.test(this[b]) ? this[b] + this[b + 1] : this[b]
};
String.prototype.gtxg = function (b) {
	return /[\ud840-\ud888]/.test(this[b]) ? 2 : 1
};
ByID("settop").onclick = function (b) {
	"\ud83d\udd1d" == this.innerHTML ? (ByID("set").style.position = "fixed", this.innerHTML = "\u2935\ufe0f") : (ByID("set").style.position = "absolute", this.innerHTML = "\ud83d\udd1d")
};
ByID("hlp").onclick = function (b) {
	if ("\u2753" == this.innerHTML)
		this.innerHTML = "\u2757", ByID("set").onmouseover = function (b) {
			var e = b.target.tagName,
			k = b.target.value ? 15 > b.target.value.length ? b.target.value : b.target.value.substring(0, 12) + "..." : "\u65e0\u503c";
			!b.target.id || "SELECT" != e && "INPUT" != e && "TEXTAREA" != e && "SPAN" != e || (b.target.title = "ID: " + b.target.id + "\nVAL:" + k + "\nDES:" + help[b.target.id])
		};
	else
		for (v in this.innerHTML = "\u2753", ByID("set").onmouseover = null, b = ByID("set").children, b)
			"hlp" !== b[v].id && (b[v].title = "");
	container.onmouseover = "block" == container.style.display ? function (b) {
		"value" == b.target.className && (b.target.title = help[b.target.parentNode.previousElementSibling.previousElementSibling.firstElementChild.innerHTML])
	}
	 : null
};
function pagekai(b, e, f, k) {
	var g = 0,
	h = g = 0,
	p = h = 0,
	h = Math.ceil(e / 4);
	e = 4 * h;
	g = Math.ceil(b / 4);
	g = Math.floor(g / h);
	p = Math.ceil((b - g * e) / 4);
	h = 4 * p;
	b = function (b, e) {
		for (var g = e + b - 1, h = [], k = [], n = e; n < b / 2 + e; n++)
			h.push(n + f), k.push(g + f), g--;
		return [h, k]
	};
	for (var u = [], A = 0; A < g; A++)
		u.push(b(e, A * e));
	p && u.push(b(h, g * e));
	k && u[0][0][0] > pidx && (u[u.length - 1][1][0] = u[0][0][0] - 1);
	return u
}
var MCk = function (b) {
	b.focus();
	var e = document.createEvent("MouseEvents");
	e.initEvent("click", !0, !0);
	b.dispatchEvent(e)
}, SMDk = function (b, e) {
	e = e ? e : 0;
	b.focus();
	var f = new MouseEvent("mousedown", {
			bubbles : !0,
			cancelable : !0,
			view : window,
			button : e
		});
	b.dispatchEvent(f)
}, rtest = function (b) {
	var e = b.split("\x3d"),
	e = new RegExp(e[0] + "\x3d[^,]*", "gim");
	if (e.test(rput.value) && (e = rput.value.match(e), confirm("\u68c0\u6d4b\u5230\u540c\u5b57\u66ff\u6362\u6587\u672c:" + e + "  \u662f\u5426\u5220\u9664\u65e7\u9879???")))
		for (c in e)
			rput.value = rput.value.replace(e[c], "");
	rput.value += b
}, drawRoundedRectangle = function (b, e, f, k, g, h, p) {
	b.beginPath();
	b.moveTo(e + h, f);
	b.fillStyle = b.strokeStyle = p;
	canv.lineWidth = h;
	b.lineTo(e + k - h, f);
	b.arc(e + k - h, f + h, h, 1.5 * Math.PI, 2 * Math.PI);
	b.lineTo(e + k, f + g - h);
	b.arc(e + k - h, f + g - h, h, 0, .5 * Math.PI);
	b.lineTo(e + h, f + g);
	b.arc(e + h, f + g - h, h, .5 * Math.PI, Math.PI);
	b.lineTo(e, f + h);
	b.arc(e + h, f + h, h, Math.PI, 1.5 * Math.PI);
	b.fill()
}, bntflg = 0, colorfx = 128, movebox = [0, 0, 0], movepx = 1;
boxdiv.onmousedown = function (b) {};
var exppagein = function (b, e) {
	CZTlist = 2;
	selectbox = [];
	bntflg = 5;
	ByID("docr") && document.body.removeChild(ByID("docr"));
	canv.fillStyle = "rgba(255,255,255,255)";
	canv.fillRect(0, 0, canvs.width, canvs.height);
	try {
		var f = JSON.parse(b)
	} catch (h) {
		alert("\u6570\u636e\u8f6c\u6362\u6709\u9519\u8bef:" + h)
	}
	f.txt || alert("\u7a7a\u5185\u5bb9\u6587\u672c");
	Tlist = [[], [], [], [], []];
	lput.value = ptset.bodyobj.txt = f.txt;
	mput.value = ptset.bodyobj.pic.imgtxt = f.pic;
	rput.value = ptset.bodyobj.ret = f.rxt;
	thisrpage.value = f.prxt;
	pagepdf[0] = pidx = parseInt(thisrpage.value);
	thisfpage.value = f.pfxt;
	thisfpage.value && (pidx = parseInt(thisfpage.value), pagepdf[0] = pidx - 1);
	var k = f.images;
	selectbox = f.sct;
	for (f = 0; f < k.length; f++) {
		Tlist[0][f] = k[f].txt;
		Tlist[4][f] = [k[f].x, k[f].y, k[f].w, k[f].h];
		var g = new Image;
		Tlist[3][f] = [g, k[f].id];
		g.src = k[f].url + "\x26t\x3d" + e + "#" + k[f].id;
		g.setAttribute("crossOrigin", "anonymous");
		g.onload = function (b) {
			b = parseInt(this.src.split("#")[1]);
			Tlist[1][b] = this.naturalWidth;
			Tlist[2][b] = this.naturalHeight
		}
	}
	MCk(ptbody)
}, selectboxfun = function () {
	for (var b = selectbox[0].list, e = boxdiv.querySelectorAll(".box"), f = 0; f < e.length; f++) {
		var k = e[f].getAttribute("imd");
		0 < b.indexOf("," + k + ",") ? e[f].className = "box boxs" : e[f].className = "box"
	}
	ByID("stxval").value = selectbox[0].rect;
	colorlist[0] = selectbox[0].fcl;
	colorlist[1] = selectbox[0].mcl;
	colorlist[2] = selectbox[0].bcl;
	b = document.createEvent("MouseEvents");
	b.initEvent("click", !0, !0);
	ByID("sethcol").dispatchEvent(b)
}, exppageout = function () {
	var b = {};
	b.txt = lput.value;
	b.pic = mput.value;
	b.rxt = rput.value;
	b.pfxt = thisfpage.value;
	b.prxt = thisrpage.value;
	b.sct = selectbox;
	for (var e = [], f = 0; f < Tlist[0].length; f++) {
		var k = {};
		k.txt = Tlist[0][f] ? Tlist[0][f] : "";
		k.x = Tlist[4][f][0];
		k.y = Tlist[4][f][1];
		k.w = Tlist[4][f][2];
		k.h = Tlist[4][f][3];
		k.id = Tlist[3][f] ? Tlist[3][f][1] : 0;
		k.url = Tlist[3][f] ? Tlist[3][f][0].src.replace(/&t=\d+#\d+/g, "") : "";
		e.push(k)
	}
	b.images = e;
	down(pidx + ".json", JSON.stringify(b))
};
boxdiv.oncontextmenu = function (b) {
	return !1
};
var qucong = function (b) {
	b.sort();
	for (var e = [b[0]], f = 0; f < b.length; f++)
		b[f] && b[f] !== e[e.length - 1] && e.push(b[f]);
	return e
}, bookfull = [];
window.onmessage = function (b) {
	if ("$" == b.data[0])
		eval(b.data.slice(1));
	else if ("#" == b.data[0]) {
		var e = b.data.slice(2);
		if ("R" == b.data[1]) {
			var f = getLocation(rput);
			b = rput.value;
			for (var k = 0, g = f; g < b.length && "," != b.charAt(g); g++)
				k++;
			for (var h = f + k, k = 0, g = f; 0 <= g && "," != b.charAt(g); g--)
				k++;
			f = f - k + 1;
			setLocation(rput, f, h);
			b = b.substring(f, h);
			e = b.split("\x3d")[0] + "\x3d" + e;
			confirm("\u662f\u5426\u63d2\u5165\u66ff\u6362\u56fe\u7247\u540d:\n" + b + "\n\u4e3a:\n" + e) && (rput.value = rput.value.del(f, h - f), rput.value = rput.value.splice(f, e))
		} else
			b = parseInt(b.data[1]), b & 1 && (mput.value = ""), f = getLocation(lput), 0 == f && !confirm("\u662f\u5426\u63d2\u5165\u5230\u5f00\u59cb\u4f4d\u7f6e???") || f == lput.value.length && !confirm("\u662f\u5426\u63d2\u5165\u5230\u7ed3\u675f\u4f4d\u7f6e???") || (lput.value = lput.value.splice(f, e), b & 2 && MCk(covertxt))
	} else if ("{" == b.data[0]) {
		if (e = JSON.parse(b.data), progress(parseInt(e.index[0] / e.index[1] * 100), e.index[0] + "/" + e.index[1] + "\x3cbr/\x3e" + e.title, 5, 2), bookfull.push(e), 1 == e.index[0] / e.index[1]) {
			e = "" + ("[book_name]" + bookfull[0].name + "\n");
			e += "[book_date]" + bookfull[0].date + "\n";
			for (g = 0; g < bookfull.length; g++)
				e += "object" === typeof bookfull[g].fulltext ? "[book_title]" + bookfull[g].title : "[book_chapter]" + bookfull[g].title + "\n", "object" === typeof bookfull[g].fulltext && (e += "\n" + bookfull[g].fulltext.join("\n") + "\n");
			down(bookfull[0].name + ".txt", e);
			bookfull = []
		}
	} else if (b.data) {
		var p = new Image;
		p.setAttribute("crossOrigin", "anonymous");
		p.src = "!" == b.data[0] ? b.data.slice(1) : b.data;
		p.onload = function (b) {
			Tlist[3][editbox[0][5]][0] = p;
			editbox[1](Tlist[4][editbox[0][5]][0], Tlist[4][editbox[0][5]][1], Tlist[4][editbox[0][5]][2], Tlist[4][editbox[0][5]][3]);
			canv.drawImage(Tlist[3][editbox[0][5]][0], Tlist[4][editbox[0][5]][0], Tlist[4][editbox[0][5]][1], Tlist[4][editbox[0][5]][2], Tlist[4][editbox[0][5]][3])
		}
	}
};